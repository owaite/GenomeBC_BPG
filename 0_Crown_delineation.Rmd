# Crown delineation 

We are using supercells to create delineated crowns using:

1) A shapefile (.shp) with a grid of tree locations derived by georeferencing the census data to the imagery. This will be referred to as the “grid”. Detailed steps for creating the grid can be found in the [Georeferencing Plot Trees](0_Tree_Georeferencing#Georeferencing Plot Trees) chapter

2) Co-registered CHM made from normalized maximum elevation (Z) values, MicaSense orthomosaic, and P1 orthomosaic, ideally from the same date. 

The R code contains commented sections where manual editing in a GIS is required. Below steps starting with (R) are steps done in the R code and (GIS) are steps requiring editing in a GIS such as QGIS or ArcGIS. The R code does the following: 

- (R) The grid treetop points are buffered by 30-40cm, and using the CHM, the grid is snapped to the maximum value within this circle. 

- (GIS) Check the location of the treetops to the P1 orthomosaic and manual move treetops to align with trees in the P1 orthomosaic where necessary. 

- (R) Load in manually edited treetops, create circles proportional to tree height. 

- (R) Create a delineation raster using the CHM and MicaSense and P1 orthomosaics 

- (R) Filter out segments that do not touch any of the circles proportional to tree height 

- (R) Merge remaining segments to create crown polygons 

- (GIS) Load into a GIS, along with the edited treetops and P1 orthomosaic, and edit the crown polygons to remove sections where neighbouring branches intersect the crown to ensure the crowns contain only data from the correct tree.  Obscured trees are given a crown confidence score and can be removed at analysis.  This is the most manually time-consuming process in the whole project.    














```{r delin-crowns, echo=FALSE,fig.align = 'center',out.width="60%", fig.cap= "Delineated crowns at Bit Tree Creek with partially obscured plot trees in purple."}
knitr::include_graphics(here("Photos_&_gifs\\crowns.PNG"))
```