<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Georeferencing Plot Trees | Guidelines and Procedures for Drone Based Phenotyping in Forest Research Trials</title>
  <meta name="description" content="Chapter 8 Georeferencing Plot Trees | Guidelines and Procedures for Drone Based Phenotyping in Forest Research Trials" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Georeferencing Plot Trees | Guidelines and Procedures for Drone Based Phenotyping in Forest Research Trials" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Georeferencing Plot Trees | Guidelines and Procedures for Drone Based Phenotyping in Forest Research Trials" />
  
  
  

<meta name="author" content="Jake King*, Olivia Waite, Miriam Isaac-Renton, Nicholas C. Coops, Samuel Grubinger, Liam Irwin, Lise Van Der Merwe, Jon Degner, Alex Liu" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="processing-orthomosaics.html"/>
<link rel="next" href="crown-delineation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Drone Based Phenotyping for Research Trials</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Guidelines and Procedures for Drone Based Phenotyping in Forest Research Trials</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#github-link"><i class="fa fa-check"></i>GitHub link</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-cite-this-report"><i class="fa fa-check"></i>How to cite this report:</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i><b>2</b> Glossary</a></li>
<li class="chapter" data-level="3" data-path="range-of-sites-assessed.html"><a href="range-of-sites-assessed.html"><i class="fa fa-check"></i><b>3</b> Range of Sites Assessed</a>
<ul>
<li class="chapter" data-level="3.1" data-path="range-of-sites-assessed.html"><a href="range-of-sites-assessed.html#jordan-river"><i class="fa fa-check"></i><b>3.1</b> Jordan River</a></li>
<li class="chapter" data-level="3.2" data-path="range-of-sites-assessed.html"><a href="range-of-sites-assessed.html#powell-river"><i class="fa fa-check"></i><b>3.2</b> Powell River</a></li>
<li class="chapter" data-level="3.3" data-path="range-of-sites-assessed.html"><a href="range-of-sites-assessed.html#sites"><i class="fa fa-check"></i><b>3.3</b> 2024 Sites</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="preflight-planning.html"><a href="preflight-planning.html"><i class="fa fa-check"></i><b>4</b> Preflight Planning</a>
<ul>
<li class="chapter" data-level="4.1" data-path="preflight-planning.html"><a href="preflight-planning.html#achieving-positional-accuracy-on-multi-temporal-and-multi-sensor-data-collections"><i class="fa fa-check"></i><b>4.1</b> Achieving positional accuracy on multi-temporal and multi-sensor data collections</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="preflight-planning.html"><a href="preflight-planning.html#kinematic-processing-rtkppk"><i class="fa fa-check"></i><b>4.1.1</b> Kinematic processing: RTK/PPK</a></li>
<li class="chapter" data-level="4.1.2" data-path="preflight-planning.html"><a href="preflight-planning.html#ground-control-points-gcp"><i class="fa fa-check"></i><b>4.1.2</b> Ground Control Points (GCP)</a></li>
<li class="chapter" data-level="4.1.3" data-path="preflight-planning.html"><a href="preflight-planning.html#absolute-and-relative-reference-with-precise-point-positioning-ppp"><i class="fa fa-check"></i><b>4.1.3</b> Absolute and Relative Reference with Precise Point Positioning (PPP)</a></li>
<li class="chapter" data-level="4.1.4" data-path="preflight-planning.html"><a href="preflight-planning.html#terrain-following-on-sites-with-elevation-change"><i class="fa fa-check"></i><b>4.1.4</b> Terrain Following on Sites with Elevation Change</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="preflight-planning.html"><a href="preflight-planning.html#site-selection-considerations"><i class="fa fa-check"></i><b>4.2</b> Site Selection Considerations</a></li>
<li class="chapter" data-level="4.3" data-path="preflight-planning.html"><a href="preflight-planning.html#drone-and-sensors-what-will-i-need-to-purchase-and-how-much-will-it-cost"><i class="fa fa-check"></i><b>4.3</b> Drone and Sensors: What will I need to purchase and how much will it cost?</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="preflight-planning.html"><a href="preflight-planning.html#hardware-costs"><i class="fa fa-check"></i><b>4.3.1</b> Hardware Costs</a></li>
<li class="chapter" data-level="4.3.2" data-path="preflight-planning.html"><a href="preflight-planning.html#drone-training-in-canada"><i class="fa fa-check"></i><b>4.3.2</b> Drone Training in Canada</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html"><i class="fa fa-check"></i><b>5</b> Data Collection and Flights</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#hardware---dji-matrice-300-rtk-m300"><i class="fa fa-check"></i><b>5.1</b> Hardware - DJI Matrice 300 RTK (M300)</a></li>
<li class="chapter" data-level="5.2" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#battery-management"><i class="fa fa-check"></i><b>5.2</b> Battery Management</a></li>
<li class="chapter" data-level="5.3" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#Site-Reconnaissance"><i class="fa fa-check"></i><b>5.3</b> Workflow: Site Reconnaissance</a></li>
<li class="chapter" data-level="5.4" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#data-collection-flight-planning"><i class="fa fa-check"></i><b>5.4</b> Data Collection: Flight Planning</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#flight-planning-theory"><i class="fa fa-check"></i><b>5.4.1</b> Flight planning theory</a></li>
<li class="chapter" data-level="5.4.2" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#flight-planning-with-dji-pilot"><i class="fa fa-check"></i><b>5.4.2</b> Flight planning with DJI Pilot</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#data-collection-sensors-parameters-and-ideal-conditions"><i class="fa fa-check"></i><b>5.5</b> Data Collection: Sensors, Parameters, and Ideal Conditions</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#micasense-10-band-spectral-sensor-for-vegetative-indices"><i class="fa fa-check"></i><b>5.5.1</b> MicaSense: 10-Band Spectral Sensor for Vegetative Indices</a></li>
<li class="chapter" data-level="5.5.2" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#zenmuse-p1-high-quality-natural-colour-rgb-imagery"><i class="fa fa-check"></i><b>5.5.2</b> Zenmuse P1: High-Quality Natural-Colour (RGB) Imagery</a></li>
<li class="chapter" data-level="5.5.3" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#zenmuse-l1-lidar-and-rgb"><i class="fa fa-check"></i><b>5.5.3</b> Zenmuse L1: LiDAR and RGB</a></li>
<li class="chapter" data-level="5.5.4" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#zenmuse-h20t-thermal-and-rgb"><i class="fa fa-check"></i><b>5.5.4</b> Zenmuse H20T: Thermal and RGB</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-processing-software-and-hardware-costs-and-options.html"><a href="data-processing-software-and-hardware-costs-and-options.html"><i class="fa fa-check"></i><b>6</b> Data Processing: Software and hardware costs and options</a></li>
<li class="chapter" data-level="7" data-path="processing-orthomosaics.html"><a href="processing-orthomosaics.html"><i class="fa fa-check"></i><b>7</b> Agisoft Photogrammetry pipeline</a>
<ul>
<li class="chapter" data-level="7.1" data-path="processing-orthomosaics.html"><a href="processing-orthomosaics.html#overview"><i class="fa fa-check"></i><b>7.1</b> Overview</a></li>
<li class="chapter" data-level="7.2" data-path="processing-orthomosaics.html"><a href="processing-orthomosaics.html#detailed-workflow"><i class="fa fa-check"></i><b>7.2</b> Detailed Workflow</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="georeferencing-plot-trees.html"><a href="georeferencing-plot-trees.html"><i class="fa fa-check"></i><b>8</b> Georeferencing Plot Trees</a>
<ul>
<li class="chapter" data-level="8.1" data-path="georeferencing-plot-trees.html"><a href="georeferencing-plot-trees.html#Workflow-in-QGIS"><i class="fa fa-check"></i><b>8.1</b> Workflow in QGIS</a></li>
<li class="chapter" data-level="8.2" data-path="georeferencing-plot-trees.html"><a href="georeferencing-plot-trees.html#alternate-workflow-in-r"><i class="fa fa-check"></i><b>8.2</b> Alternate Workflow in R</a></li>
<li class="chapter" data-level="8.3" data-path="georeferencing-plot-trees.html"><a href="georeferencing-plot-trees.html#final-steps-in-qgis"><i class="fa fa-check"></i><b>8.3</b> Final Steps in QGIS</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="crown-delineation.html"><a href="crown-delineation.html"><i class="fa fa-check"></i><b>9</b> Crown Delineation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="crown-delineation.html"><a href="crown-delineation.html#circles-proportional-to-tree-height"><i class="fa fa-check"></i><b>9.1</b> Circles Proportional to Tree Height</a></li>
<li class="chapter" data-level="9.2" data-path="crown-delineation.html"><a href="crown-delineation.html#supercell-raster"><i class="fa fa-check"></i><b>9.2</b> Supercell Raster</a></li>
<li class="chapter" data-level="9.3" data-path="crown-delineation.html"><a href="crown-delineation.html#filter-merge-supercells"><i class="fa fa-check"></i><b>9.3</b> Filter &amp; Merge Supercells</a></li>
<li class="chapter" data-level="9.4" data-path="crown-delineation.html"><a href="crown-delineation.html#manually-edit-crowns"><i class="fa fa-check"></i><b>9.4</b> Manually Edit Crowns</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="shadow-mask.html"><a href="shadow-mask.html"><i class="fa fa-check"></i><b>10</b> Shadow Masks</a></li>
<li class="chapter" data-level="11" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html"><i class="fa fa-check"></i><b>11</b> MicaSense Irradiance Correction</a>
<ul>
<li class="chapter" data-level="11.1" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html#background"><i class="fa fa-check"></i><b>11.1</b> Background</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html#deriving-horizontal-irradiance"><i class="fa fa-check"></i><b>11.1.1</b> Deriving Horizontal Irradiance</a></li>
<li class="chapter" data-level="11.1.2" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html#calculating-reflectance"><i class="fa fa-check"></i><b>11.1.2</b> Calculating Reflectance</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html#the-problem"><i class="fa fa-check"></i><b>11.2</b> The Problem</a></li>
<li class="chapter" data-level="11.3" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html#is-correction-needed"><i class="fa fa-check"></i><b>11.3</b> Is Correction Needed?</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html#do-the-sun-sensor-angles-make-sense"><i class="fa fa-check"></i><b>11.3.1</b> Do the sun sensor angles make sense?</a></li>
<li class="chapter" data-level="11.3.2" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html#does-the-relationship-between-direct-and-horizontal-irradiance-make-sense"><i class="fa fa-check"></i><b>11.3.2</b> Does the relationship between direct and horizontal irradiance make sense?</a></li>
<li class="chapter" data-level="11.3.3" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html#does-the-scattered-direct-ratio-make-sense-for-the-lighting-conditions-of-that-day"><i class="fa fa-check"></i><b>11.3.3</b> Does the scattered: direct ratio make sense for the lighting conditions of that day?</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html#DLS1-correction"><i class="fa fa-check"></i><b>11.4</b> Correcting Irradiance Values for MicaSense Cameras</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html#reading-exif-data"><i class="fa fa-check"></i><b>11.4.1</b> Reading Exif Data</a></li>
<li class="chapter" data-level="11.4.2" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html#calculating-solar-zenith-angle"><i class="fa fa-check"></i><b>11.4.2</b> Calculating Solar Zenith Angle</a></li>
<li class="chapter" data-level="11.4.3" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html#SSA-correction"><i class="fa fa-check"></i><b>11.4.3</b> Calculating Sun-Sensor Angles</a></li>
<li class="chapter" data-level="11.4.4" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html#scattered-direct-ratio-estimate"><i class="fa fa-check"></i><b>11.4.4</b> Scattered: Direct Ratio Estimate</a></li>
<li class="chapter" data-level="11.4.5" data-path="MicaSense-Irradiance-Correction.html"><a href="MicaSense-Irradiance-Correction.html#computing-horizontal-corrected-irradiance"><i class="fa fa-check"></i><b>11.4.5</b> Computing Horizontal (Corrected) Irradiance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="Thermal-Conversion.html"><a href="Thermal-Conversion.html"><i class="fa fa-check"></i><b>12</b> Thermal Conversion</a>
<ul>
<li class="chapter" data-level="12.1" data-path="Thermal-Conversion.html"><a href="Thermal-Conversion.html#folder-set-up"><i class="fa fa-check"></i><b>12.1</b> Folder Set-Up</a></li>
<li class="chapter" data-level="12.2" data-path="Thermal-Conversion.html"><a href="Thermal-Conversion.html#weather-data"><i class="fa fa-check"></i><b>12.2</b> Weather Data</a></li>
<li class="chapter" data-level="12.3" data-path="Thermal-Conversion.html"><a href="Thermal-Conversion.html#dji-thermal-sdk-temperature-conversion"><i class="fa fa-check"></i><b>12.3</b> DJI Thermal SDK: temperature conversion</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="Thermal-Conversion.html"><a href="Thermal-Conversion.html#parameters"><i class="fa fa-check"></i><b>12.3.1</b> Parameters</a></li>
<li class="chapter" data-level="12.3.2" data-path="Thermal-Conversion.html"><a href="Thermal-Conversion.html#running-the-sdk"><i class="fa fa-check"></i><b>12.3.2</b> Running the SDK</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="Thermal-Conversion.html"><a href="Thermal-Conversion.html#convert-to-raster"><i class="fa fa-check"></i><b>12.4</b> Convert to Raster</a></li>
<li class="chapter" data-level="12.5" data-path="Thermal-Conversion.html"><a href="Thermal-Conversion.html#examples"><i class="fa fa-check"></i><b>12.5</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="Vegetation-Indicies.html"><a href="Vegetation-Indicies.html"><i class="fa fa-check"></i><b>13</b> Crown-level Vegetation Indicies</a>
<ul>
<li class="chapter" data-level="13.1" data-path="Vegetation-Indicies.html"><a href="Vegetation-Indicies.html#vi-workflow"><i class="fa fa-check"></i><b>13.1</b> VI Workflow</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html"><i class="fa fa-check"></i><b>14</b> LiDAR Processing Workflow</a>
<ul>
<li class="chapter" data-level="14.1" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#dji-terra"><i class="fa fa-check"></i><b>14.1</b> DJI Terra</a></li>
<li class="chapter" data-level="14.2" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#register-the-lidar-to-the-dap-point-cloud"><i class="fa fa-check"></i><b>14.2</b> Register the LiDAR to the DAP point cloud</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#prepare-lidar-for-registration"><i class="fa fa-check"></i><b>14.2.1</b> Prepare LiDAR for registration</a></li>
<li class="chapter" data-level="14.2.2" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#register-lidar-to-dap-cloud-in-cloudcompare"><i class="fa fa-check"></i><b>14.2.2</b> Register LiDAR to DAP cloud in CloudCompare</a></li>
<li class="chapter" data-level="14.2.3" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#rescale-and-tile-the-registered-lidar"><i class="fa fa-check"></i><b>14.2.3</b> Rescale and tile the registered LiDAR:</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#normalization-and-individual-tree-point-clouds"><i class="fa fa-check"></i><b>14.3</b> Normalization and individual tree point clouds</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#creating-a-dtm-from-the-registered-lidar-tiles"><i class="fa fa-check"></i><b>14.3.1</b> Creating a DTM from the registered LiDAR tiles</a></li>
<li class="chapter" data-level="14.3.2" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#normalizing-the-tiles-using-the-dtm"><i class="fa fa-check"></i><b>14.3.2</b> Normalizing the tiles using the DTM</a></li>
<li class="chapter" data-level="14.3.3" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#creating-a-4cm-chm-from-the-max-z-values"><i class="fa fa-check"></i><b>14.3.3</b> Creating a 4cm CHM from the max Z values</a></li>
<li class="chapter" data-level="14.3.4" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#segmenting-tiles"><i class="fa fa-check"></i><b>14.3.4</b> Segmenting tiles</a></li>
<li class="chapter" data-level="14.3.5" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#merging-segmented-tiles-to-create-one-large-point-cloud-containing-the-top-defined-height-of-each-tree"><i class="fa fa-check"></i><b>14.3.5</b> Merging segmented tiles to create one large point cloud containing the top defined height % of each tree</a></li>
<li class="chapter" data-level="14.3.6" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#clipping-the-point-cloud-into-individual-point-clouds-per-tree"><i class="fa fa-check"></i><b>14.3.6</b> Clipping the point cloud into individual point clouds per tree</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#individual-tree-metrics"><i class="fa fa-check"></i><b>14.4</b> Individual Tree Metrics</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Guidelines and Procedures for Drone Based Phenotyping in Forest Research Trials</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="georeferencing-plot-trees" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Georeferencing Plot Trees<a href="georeferencing-plot-trees.html#georeferencing-plot-trees" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>At this stage in the workflow we have processed high quality imagery into orthomosaics ready for analysis. The next step is to georeference the row and column census data and the high quality P1 template to geolocate the trees, which will be used later on to create individual tree polygons. Figure <a href="georeferencing-plot-trees.html#fig:genetic-layout">8.1</a> is an image of the spreadsheet map from the Big Tree creek site which is typical of many BC genetics trials. Figure <a href="georeferencing-plot-trees.html#fig:P1-genetic-layout">8.2</a> is the P1 orthomosaic template flight we georeference the census data to.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:genetic-layout"></span>
<img src="Photos_&_gifs/genetic_layout2.png" alt="The spreadsheet map of the layout of the site, each tree is located on a grid with a unique row and column value assigned to it." width="100%" />
<p class="caption">
Figure 8.1: The spreadsheet map of the layout of the site, each tree is located on a grid with a unique row and column value assigned to it.
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:P1-genetic-layout"></span>
<img src="Photos_&_gifs/genetic_layout_P1.png" alt="P1 orthomosaic of the site with GCPs and georeferenced trees marked with red dots" width="100%" />
<p class="caption">
Figure 8.2: P1 orthomosaic of the site with GCPs and georeferenced trees marked with red dots
</p>
</div>
<p>We have recently developed a “Grid Georeferencer” plugin in QGIS that does the initial rough georeferencing of the census data and is available for download <a href="https://github.com/owaite/GenomeBC_BPG/blob/main/Scripts/grid_georeferencer.zip">here</a>. We also have a version that works in R. Both are detailed below.</p>
<div id="Workflow-in-QGIS" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Workflow in QGIS<a href="georeferencing-plot-trees.html#Workflow-in-QGIS" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>The census data is examined, and a unique identifier column is found or created.</p>
<ol style="list-style-type: lower-alpha">
<li><p>This column is “treeID” and will be used through the rest of the data processing pipeline.</p></li>
<li><p>The census data must also contain “row” and “col” (row and column identifiers).</p></li>
</ol></li>
<li><p>The information from the <a href="data-collection-and-flights.html#Site-Reconnaissance">reconnaissance workflow</a> is used to locate reference trees.</p>
<ol style="list-style-type: lower-alpha">
<li><p>The distance, Azimuth and treeID from each GCP to the nearest plot tree was recorded as a reference tree.</p></li>
<li><p>In a GIS (in this case QGIS) a shapefile is made with the reference trees. They are visualized as red dots in Figure <a href="georeferencing-plot-trees.html#fig:P1-genetic-layout">8.2</a>. The shapefile is saved in the “working” reference system NAD83 UTM’s.</p></li>
</ol></li>
<li><p>The <strong>Grid Georeferencer</strong> plugin is run in QGIS as seen in Figure <a href="georeferencing-plot-trees.html#fig:Qgis-ref">8.3</a>. This plugin:</p>
<ol style="list-style-type: lower-alpha">
<li>builds the grid based on the row and col fields at the spacing input.</li>
<li>rotates the grid based on the input reference trees and saves a copy of this rotated version as “_rotated” in the export folder.</li>
<li>applies an affine transformation to better fit the grid to the reference trees. It saves this as “_transformed” and loads it into QGIS.</li>
</ol>
<ul>
<li>To run the plugin (see Figure <a href="georeferencing-plot-trees.html#fig:Qgis-ref">8.3</a>):
<ul>
<li>enter the Input csv and choose the extra fields to import</li>
<li>enter the grid spacing</li>
<li>enter the export location</li>
</ul></li>
</ul></li>
</ol>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:Qgis-ref"></span>
<img src="Photos_&_gifs/Qgis_grid_georef.png" alt="Visual of the Grid Georeferenced plugin in QGIS." width="80%" />
<p class="caption">
Figure 8.3: Visual of the Grid Georeferenced plugin in QGIS.
</p>
</div>
</div>
<div id="alternate-workflow-in-r" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Alternate Workflow in R<a href="georeferencing-plot-trees.html#alternate-workflow-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>Grid Georeferencer</strong> plugin described above was created by our team to make grid georeferencing easier for uptake. Here we describe our original method, based in R, for those who choose to keep their workflow in R</p>
<p>Follow steps 1-2 from the <a href="georeferencing-plot-trees.html#Workflow-in-QGIS">Workflow in QGIS</a></p>
<ol start="3" style="list-style-type: decimal">
<li><p>Identify the tree that is in the first row and first column and first row and last column:</p>
<ul>
<li>Here the tree in the first row and first column is the bottom left tree shown as a blue dot in Figures <a href="georeferencing-plot-trees.html#fig:genetic-layout">8.1</a> &amp; <a href="georeferencing-plot-trees.html#fig:P1-genetic-layout">8.2</a>). Export this tree as a shapefile which will be read into the below R script as “first-first”.
<ul>
<li>** Note ideally we would have a GCP at the bottom left corner of the site however, this was the densest section at this particular site, so the columns and rows were carefully counted in either direction from the nearest reference tree instead.</li>
</ul></li>
<li>The tree in the first row and last column is the bottom right tree in Figures <a href="georeferencing-plot-trees.html#fig:genetic-layout">8.1</a> &amp; <a href="georeferencing-plot-trees.html#fig:P1-genetic-layout">8.2</a> and coincidentally a reference tree next to <em>GCP_2</em> (Figure <a href="georeferencing-plot-trees.html#fig:P1-genetic-layout">8.2</a>). Export this tree as a shapefile which will be read into the R script as “first-last” below.</li>
</ul></li>
<li><p>Run the R script that will create a grid with the correct orientation and spacing to match your plot trees. The R script can be found <a href="https://github.com/owaite/GenomeBC_BPG/blob/main/Scripts/Treetop_Georeference.R">here</a> or in the code chunk below. ** Note this script requires <strong>North up rows</strong> and <strong>East up columns</strong> to work as scripted. Modifications will need to be made to sites with different orientations. This code will install the required libraries, set up the file structure as we use it and follow these steps:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Read in the shapefiles for the first-first and first-last trees.</p></li>
<li><p>Load the CSV file, filter for the required columns. At Big Tree we want the row, col, treeID and the most recent assessments, which here are a 2012 remeasurement (ht12) and assessment (c12).</p></li>
<li><p>Generate Initial Grid: Create a grid of tree locations using the row and column numbers, starting from the initial point (first-first). Adjust the coordinates to account for column and row spacing.</p></li>
<li><p>Convert to Spatial Object: Convert the grid data to an sf (simple features) object in R.</p></li>
<li><p>Identify Reference Point: Extract the coordinates of the tree in the first column and the last row (first_last_sf) from the grid.</p></li>
<li><p>Calculate Rotation Angle: Define a function to rotate coordinates. Calculate the angle of rotation needed to align the grid with the actual positions of the initial points.</p></li>
<li><p>Rotate Grid: Apply the rotation to all points in the grid.</p></li>
<li><p>Merge and Save Results: Merge the rotated coordinates with the original grid data. Set the CRS and save the resulting grid as a shapefile.</p></li>
<li><p>Plot Final Grid: Plot the final rotated grid to visualize the tree locations.</p></li>
</ol></li>
</ol>
<details>
<summary>
Click to show the code
</summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="georeferencing-plot-trees.html#cb5-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-2"><a href="georeferencing-plot-trees.html#cb5-2" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb5-3"><a href="georeferencing-plot-trees.html#cb5-3" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb5-4"><a href="georeferencing-plot-trees.html#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="georeferencing-plot-trees.html#cb5-5" tabindex="-1"></a>dir <span class="ot">=</span> <span class="st">&quot;Q:</span><span class="sc">\\</span><span class="st">SNC</span><span class="sc">\\</span><span class="st">Data</span><span class="sc">\\</span><span class="st">Big_Tree_GCA</span><span class="sc">\\</span><span class="st">&quot;</span></span>
<span id="cb5-6"><a href="georeferencing-plot-trees.html#cb5-6" tabindex="-1"></a>name <span class="ot">&lt;-</span> <span class="st">&quot;Big_Tree&quot;</span></span>
<span id="cb5-7"><a href="georeferencing-plot-trees.html#cb5-7" tabindex="-1"></a>csv_path <span class="ot">=</span> <span class="fu">paste0</span>(dir, <span class="st">&quot;Census_Data</span><span class="sc">\\</span><span class="st">#4_bigtree_gca_masterfile.csv&quot;</span>)</span>
<span id="cb5-8"><a href="georeferencing-plot-trees.html#cb5-8" tabindex="-1"></a>trees <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Site_Info</span><span class="sc">\\</span><span class="st">03_GIS</span><span class="sc">\\</span><span class="st">shapefiles&quot;</span>)</span>
<span id="cb5-9"><a href="georeferencing-plot-trees.html#cb5-9" tabindex="-1"></a><span class="co">#shapfiles for the below trees were done in a GIS off high res imagery</span></span>
<span id="cb5-10"><a href="georeferencing-plot-trees.html#cb5-10" tabindex="-1"></a>first_first <span class="ot">=</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(dir, trees, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">first_first.shp&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-11"><a href="georeferencing-plot-trees.html#cb5-11" tabindex="-1"></a>  <span class="fu">st_geometry</span>()</span>
<span id="cb5-12"><a href="georeferencing-plot-trees.html#cb5-12" tabindex="-1"></a>first_last <span class="ot">=</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(dir, trees, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">first_last.shp&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-13"><a href="georeferencing-plot-trees.html#cb5-13" tabindex="-1"></a>  <span class="fu">st_geometry</span>()</span>
<span id="cb5-14"><a href="georeferencing-plot-trees.html#cb5-14" tabindex="-1"></a></span>
<span id="cb5-15"><a href="georeferencing-plot-trees.html#cb5-15" tabindex="-1"></a><span class="co"># column spacing in m </span></span>
<span id="cb5-16"><a href="georeferencing-plot-trees.html#cb5-16" tabindex="-1"></a>c_space <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb5-17"><a href="georeferencing-plot-trees.html#cb5-17" tabindex="-1"></a><span class="co"># row spacing in m </span></span>
<span id="cb5-18"><a href="georeferencing-plot-trees.html#cb5-18" tabindex="-1"></a>r_space <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb5-19"><a href="georeferencing-plot-trees.html#cb5-19" tabindex="-1"></a><span class="co"># read in the CSV</span></span>
<span id="cb5-20"><a href="georeferencing-plot-trees.html#cb5-20" tabindex="-1"></a>(<span class="at">csv_B =</span> <span class="fu">read.csv</span>(csv_path) <span class="sc">%&gt;%</span> </span>
<span id="cb5-21"><a href="georeferencing-plot-trees.html#cb5-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(treeID, row, col, ht12, c12))</span>
<span id="cb5-22"><a href="georeferencing-plot-trees.html#cb5-22" tabindex="-1"></a><span class="co"># produce a grid using row and column numbers, to be rotated</span></span>
<span id="cb5-23"><a href="georeferencing-plot-trees.html#cb5-23" tabindex="-1"></a>grid <span class="ot">=</span> csv_B <span class="sc">%&gt;%</span> </span>
<span id="cb5-24"><a href="georeferencing-plot-trees.html#cb5-24" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-25"><a href="georeferencing-plot-trees.html#cb5-25" tabindex="-1"></a>    <span class="at">x_coord =</span> <span class="fu">st_coordinates</span>(first_first)[<span class="dv">1</span>] <span class="sc">+</span> (col <span class="sc">*</span> c_space) <span class="sc">-</span> c_space,</span>
<span id="cb5-26"><a href="georeferencing-plot-trees.html#cb5-26" tabindex="-1"></a>    <span class="at">y_coord =</span> <span class="fu">st_coordinates</span>(first_first)[<span class="dv">2</span>] <span class="sc">+</span> (row <span class="sc">*</span> r_space) <span class="sc">-</span> c_space)</span>
<span id="cb5-27"><a href="georeferencing-plot-trees.html#cb5-27" tabindex="-1"></a><span class="co"># to sf object</span></span>
<span id="cb5-28"><a href="georeferencing-plot-trees.html#cb5-28" tabindex="-1"></a>grid_sf <span class="ot">=</span> <span class="fu">st_as_sf</span>(grid, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;x_coord&quot;</span>, <span class="st">&quot;y_coord&quot;</span>), <span class="at">crs =</span> <span class="dv">26910</span>)</span>
<span id="cb5-29"><a href="georeferencing-plot-trees.html#cb5-29" tabindex="-1"></a><span class="co"># get the coordinates of the first-last</span></span>
<span id="cb5-30"><a href="georeferencing-plot-trees.html#cb5-30" tabindex="-1"></a>first_last_sf <span class="ot">=</span> grid_sf <span class="sc">%&gt;%</span> </span>
<span id="cb5-31"><a href="georeferencing-plot-trees.html#cb5-31" tabindex="-1"></a>  <span class="fu">filter</span>(row <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-32"><a href="georeferencing-plot-trees.html#cb5-32" tabindex="-1"></a>  <span class="fu">filter</span>(col <span class="sc">==</span> <span class="fu">max</span>(.<span class="sc">$</span>col)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-33"><a href="georeferencing-plot-trees.html#cb5-33" tabindex="-1"></a>  <span class="fu">st_geometry</span>()</span>
<span id="cb5-34"><a href="georeferencing-plot-trees.html#cb5-34" tabindex="-1"></a><span class="co"># define a FUNCTION which rotates coords for a given angle</span></span>
<span id="cb5-35"><a href="georeferencing-plot-trees.html#cb5-35" tabindex="-1"></a>rot <span class="ot">=</span> <span class="cf">function</span>(a) <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">cos</span>(a), <span class="fu">sin</span>(a), <span class="sc">-</span><span class="fu">sin</span>(a), <span class="fu">cos</span>(a)), <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb5-36"><a href="georeferencing-plot-trees.html#cb5-36" tabindex="-1"></a><span class="co"># get the angle of rotation between the true (first, last) and</span></span>
<span id="cb5-37"><a href="georeferencing-plot-trees.html#cb5-37" tabindex="-1"></a><span class="co"># the current position of (first, last)</span></span>
<span id="cb5-38"><a href="georeferencing-plot-trees.html#cb5-38" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">st_coordinates</span>(first_last <span class="sc">-</span> first_first)</span>
<span id="cb5-39"><a href="georeferencing-plot-trees.html#cb5-39" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">st_coordinates</span>(first_last_sf <span class="sc">-</span> first_first)</span>
<span id="cb5-40"><a href="georeferencing-plot-trees.html#cb5-40" tabindex="-1"></a>theta <span class="ot">=</span> <span class="fu">acos</span>( <span class="fu">sum</span>(a<span class="sc">*</span>b) <span class="sc">/</span> ( <span class="fu">sqrt</span>(<span class="fu">sum</span>(a <span class="sc">*</span> a)) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(b <span class="sc">*</span> b)) ) )</span>
<span id="cb5-41"><a href="georeferencing-plot-trees.html#cb5-41" tabindex="-1"></a><span class="co"># rotate all points </span></span>
<span id="cb5-42"><a href="georeferencing-plot-trees.html#cb5-42" tabindex="-1"></a>grid_rot <span class="ot">=</span> (<span class="fu">st_geometry</span>(grid_sf) <span class="sc">-</span> first_first) <span class="sc">*</span> <span class="fu">rot</span>((theta)) <span class="sc">+</span> first_first</span>
<span id="cb5-43"><a href="georeferencing-plot-trees.html#cb5-43" tabindex="-1"></a><span class="co"># in order to merge the new coordinates and the census info, copy the sf object created from the master csv</span></span>
<span id="cb5-44"><a href="georeferencing-plot-trees.html#cb5-44" tabindex="-1"></a>grid_rot_sf <span class="ot">=</span> grid_sf</span>
<span id="cb5-45"><a href="georeferencing-plot-trees.html#cb5-45" tabindex="-1"></a><span class="co"># then replace its geometry with the rotated coords</span></span>
<span id="cb5-46"><a href="georeferencing-plot-trees.html#cb5-46" tabindex="-1"></a><span class="fu">st_geometry</span>(grid_rot_sf) <span class="ot">=</span> grid_rot</span>
<span id="cb5-47"><a href="georeferencing-plot-trees.html#cb5-47" tabindex="-1"></a><span class="co"># and set its CRS to the correct one</span></span>
<span id="cb5-48"><a href="georeferencing-plot-trees.html#cb5-48" tabindex="-1"></a><span class="fu">st_crs</span>(grid_rot_sf) <span class="ot">=</span> <span class="dv">26910</span></span>
<span id="cb5-49"><a href="georeferencing-plot-trees.html#cb5-49" tabindex="-1"></a><span class="co">#save rotated grid</span></span>
<span id="cb5-50"><a href="georeferencing-plot-trees.html#cb5-50" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> grid_rot_sf,</span>
<span id="cb5-51"><a href="georeferencing-plot-trees.html#cb5-51" tabindex="-1"></a>         <span class="at">dsn =</span> <span class="fu">paste0</span>(dir, trees, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">&quot;</span>, name, <span class="st">&quot;_grid_manual_bpg.shp&quot;</span>),</span>
<span id="cb5-52"><a href="georeferencing-plot-trees.html#cb5-52" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-53"><a href="georeferencing-plot-trees.html#cb5-53" tabindex="-1"></a>         <span class="at">crs =</span> <span class="dv">26910</span>)</span>
<span id="cb5-54"><a href="georeferencing-plot-trees.html#cb5-54" tabindex="-1"></a><span class="co">#plot(grid_rot_sf) #uncomment to plot the rotated grid</span></span></code></pre></div>
</details>
</div>
<div id="final-steps-in-qgis" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Final Steps in QGIS<a href="georeferencing-plot-trees.html#final-steps-in-qgis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The grid is loaded into the GIS and examined. The first-first corner with row 1 column 1 looks great, but the top right corner is at least 2 meters off as you can see below. This is one of the better ones we have georeferenced. The site is on even ground and was quite square. Some of the sites were 6 meters off from one corner to the other.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:ref-trees"></span>
<img src="Photos_&_gifs/ref_treeID_1.png" alt="Left: treeID 1, reference for the bottom left corner of the plot. Right: treeID 2757, reference for the top right of the plot" width="50%" /><img src="Photos_&_gifs/ref_treeID_2757.png" alt="Left: treeID 1, reference for the bottom left corner of the plot. Right: treeID 2757, reference for the top right of the plot" width="50%" />
<p class="caption">
Figure 8.4: Left: treeID 1, reference for the bottom left corner of the plot. Right: treeID 2757, reference for the top right of the plot
</p>
</div>
<p>We now use the reference trees and QGIS’ Georeferencer plugin if needed to tighten up the fit of the grid to the Orthomosaic. Open the Georeferencer and select the Transformation Settings icon as seen to the left. The polynomial 2 transformation works well, but another transformation can be tried if it doesn’t fit. Once sufficient, add the vector layer that we exported from R and zoom in on the first point that matches a reference tree as below. Then add a point and select the From Map Canvas button.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:Qgis-ref-trees"></span>
<img src="Photos_&_gifs/Qgis_transformation_settings.png" alt="Left: Transformation settings. Right: zoom in on vector layer and place a point on the Map Canvas" width="32.5%" /><img src="Photos_&_gifs/Qgis_map_cor_setting.png" alt="Left: Transformation settings. Right: zoom in on vector layer and place a point on the Map Canvas" width="67.5%" />
<p class="caption">
Figure 8.5: Left: Transformation settings. Right: zoom in on vector layer and place a point on the Map Canvas
</p>
</div>
<p>Work through the reference trees. With 6 reference trees spread evenly through the site the fit was quite good as seen here.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:Qgis-ref-tree-fit"></span>
<img src="Photos_&_gifs/Qgis-ref-tree-fit.jpg" alt="Zoomed in visual of the georeferenced tree grid for 6 trees overlain on the P1 orthomosaic." width="100%" />
<p class="caption">
Figure 8.6: Zoomed in visual of the georeferenced tree grid for 6 trees overlain on the P1 orthomosaic.
</p>
</div>
<p>From here we will manually move each tree position to its visible top. This is a time-consuming task, as care must be taken. In the above imagery the tree between 1601 and 1680 is ingress (a Western hemlock, not planted as part of the trial), the P1 imagery helps to make the distinction visible. On sites that have been recently maintained as pictured below, and if you already have a CHM, a time saving method is to buffer 30-40cm circles around your tree points, then snap the tree point to the local maximum. This can be done in R or a GIS.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:Qgis-maintained-ref-tree-fit"></span>
<img src="Photos_&_gifs/maintained-geo-ref-trees.png" alt="Georeferenced grid overlain on P1 orthomosaic for a site that was well maintained. The georeferenced grid has been snapped to the highest point on the CHM within a given radius to pull the grid to the treetops." width="100%" />
<p class="caption">
Figure 8.7: Georeferenced grid overlain on P1 orthomosaic for a site that was well maintained. The georeferenced grid has been snapped to the highest point on the CHM within a given radius to pull the grid to the treetops.
</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="processing-orthomosaics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="crown-delineation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/owaite/GenomeBC_BPG/edit/main/0_Tree_Georeferencing.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/owaite/GenomeBC_BPG/blob/main/0_Tree_Georeferencing.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
