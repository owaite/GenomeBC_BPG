<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Crown delineation | Guidelines and Procedures for Drone Based Phenotyping in Forest Research Trials</title>
  <meta name="description" content="Chapter 8 Crown delineation | Guidelines and Procedures for Drone Based Phenotyping in Forest Research Trials" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Crown delineation | Guidelines and Procedures for Drone Based Phenotyping in Forest Research Trials" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Crown delineation | Guidelines and Procedures for Drone Based Phenotyping in Forest Research Trials" />
  
  
  

<meta name="author" content="Jake King*, Olivia Waite, Miriam Isaac-Renton, Nicholas C. Coops, Samuel Grubinger, Liam Irwin, Lise Van Der Merwe, Jon Degner, Alex Liu" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="georeferencing-plot-trees.html"/>
<link rel="next" href="lidar-processing-workflow.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Drone Based Phenotyping for Research Trials</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Guidelines and Procedures for Drone Based Phenotyping in Forest Research Trials</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#github-link"><i class="fa fa-check"></i>GitHub link</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-cite-this-report"><i class="fa fa-check"></i>How to cite this report:</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="abstract.html"><a href="abstract.html"><i class="fa fa-check"></i><b>1</b> Abstract</a></li>
<li class="chapter" data-level="2" data-path="background-and-basis-of-knowledge.html"><a href="background-and-basis-of-knowledge.html"><i class="fa fa-check"></i><b>2</b> Background and basis of knowledge</a></li>
<li class="chapter" data-level="3" data-path="range-of-sites-assessed.html"><a href="range-of-sites-assessed.html"><i class="fa fa-check"></i><b>3</b> Range of Sites Assessed</a>
<ul>
<li class="chapter" data-level="3.1" data-path="range-of-sites-assessed.html"><a href="range-of-sites-assessed.html#jordan-river"><i class="fa fa-check"></i><b>3.1</b> Jordan River</a></li>
<li class="chapter" data-level="3.2" data-path="range-of-sites-assessed.html"><a href="range-of-sites-assessed.html#powell-river"><i class="fa fa-check"></i><b>3.2</b> Powell River</a></li>
<li class="chapter" data-level="3.3" data-path="range-of-sites-assessed.html"><a href="range-of-sites-assessed.html#sites"><i class="fa fa-check"></i><b>3.3</b> 2024 Sites</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="preflight-planning.html"><a href="preflight-planning.html"><i class="fa fa-check"></i><b>4</b> Preflight Planning</a>
<ul>
<li class="chapter" data-level="4.1" data-path="preflight-planning.html"><a href="preflight-planning.html#achieving-positional-accuracy-on-multi-temporal-and-multi-sensor-data-collections"><i class="fa fa-check"></i><b>4.1</b> Achieving positional accuracy on multi-temporal and multi-sensor data collections</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="preflight-planning.html"><a href="preflight-planning.html#kinematic-processing-rtkppk"><i class="fa fa-check"></i><b>4.1.1</b> Kinematic processing: RTK/PPK</a></li>
<li class="chapter" data-level="4.1.2" data-path="preflight-planning.html"><a href="preflight-planning.html#ground-control-points-gcp"><i class="fa fa-check"></i><b>4.1.2</b> Ground Control Points (GCP)</a></li>
<li class="chapter" data-level="4.1.3" data-path="preflight-planning.html"><a href="preflight-planning.html#absolute-and-relative-reference-with-precise-point-positioning-ppp"><i class="fa fa-check"></i><b>4.1.3</b> Absolute and Relative Reference with Precise Point Positioning (PPP)</a></li>
<li class="chapter" data-level="4.1.4" data-path="preflight-planning.html"><a href="preflight-planning.html#terrain-following-on-sites-with-elevation-change"><i class="fa fa-check"></i><b>4.1.4</b> Terrain Following on Sites with Elevation Change</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="preflight-planning.html"><a href="preflight-planning.html#site-selection-considerations"><i class="fa fa-check"></i><b>4.2</b> Site Selection Considerations</a></li>
<li class="chapter" data-level="4.3" data-path="preflight-planning.html"><a href="preflight-planning.html#drone-and-sensors-what-will-i-need-to-purchase-and-how-much-will-it-cost"><i class="fa fa-check"></i><b>4.3</b> Drone and Sensors: What will I need to purchase and how much will it cost?</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="preflight-planning.html"><a href="preflight-planning.html#hardware-costs"><i class="fa fa-check"></i><b>4.3.1</b> Hardware Costs</a></li>
<li class="chapter" data-level="4.3.2" data-path="preflight-planning.html"><a href="preflight-planning.html#drone-training-in-canada"><i class="fa fa-check"></i><b>4.3.2</b> Drone Training in Canada</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="preflight-planning.html"><a href="preflight-planning.html#section"><i class="fa fa-check"></i><b>4.4</b> </a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html"><i class="fa fa-check"></i><b>5</b> Data Collection and Flights</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#hardware---dji-matrice-3000-rtk-m300"><i class="fa fa-check"></i><b>5.1</b> Hardware - DJI Matrice 3000 RTK (M300)</a></li>
<li class="chapter" data-level="5.2" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#battery-management"><i class="fa fa-check"></i><b>5.2</b> Battery Management</a></li>
<li class="chapter" data-level="5.3" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#workflow-site-reconnaissance"><i class="fa fa-check"></i><b>5.3</b> Workflow: Site Reconnaissance</a></li>
<li class="chapter" data-level="5.4" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#data-collection-flight-planning"><i class="fa fa-check"></i><b>5.4</b> Data Collection: Flight Planning</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#flight-planning-theory"><i class="fa fa-check"></i><b>5.4.1</b> Flight planning theory</a></li>
<li class="chapter" data-level="5.4.2" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#flight-planning-with-dji-pilot"><i class="fa fa-check"></i><b>5.4.2</b> Flight planning with DJI Pilot</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#data-collection-sensors-parameters-and-ideal-conditions"><i class="fa fa-check"></i><b>5.5</b> Data Collection: Sensors, Parameters, and Ideal Conditions</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#micasense-10-band-spectral-sensor-for-vegetative-indices"><i class="fa fa-check"></i><b>5.5.1</b> MicaSense: 10-Band Spectral Sensor for Vegetative Indices</a></li>
<li class="chapter" data-level="5.5.2" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#zenmuse-p1-high-quality-natural-colour-rgb-imagery"><i class="fa fa-check"></i><b>5.5.2</b> Zenmuse P1: High-Quality Natural-Colour (RGB) Imagery</a></li>
<li class="chapter" data-level="5.5.3" data-path="data-collection-and-flights.html"><a href="data-collection-and-flights.html#zenmuse-l1-lidar-and-rgb"><i class="fa fa-check"></i><b>5.5.3</b> Zenmuse L1: LiDAR and RGB</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="photogrametric-processing.html"><a href="photogrametric-processing.html"><i class="fa fa-check"></i><b>6</b> Photogrametric Processing</a>
<ul>
<li class="chapter" data-level="6.1" data-path="photogrametric-processing.html"><a href="photogrametric-processing.html#processing-orthomosaics"><i class="fa fa-check"></i><b>6.1</b> Processing Orthomosaics</a></li>
<li class="chapter" data-level="6.2" data-path="photogrametric-processing.html"><a href="photogrametric-processing.html#shadow-masks"><i class="fa fa-check"></i><b>6.2</b> Shadow Masks</a></li>
<li class="chapter" data-level="6.3" data-path="photogrametric-processing.html"><a href="photogrametric-processing.html#crown-level-vegetation-indicies"><i class="fa fa-check"></i><b>6.3</b> Crown-level Vegetation Indicies</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="photogrametric-processing.html"><a href="photogrametric-processing.html#vi-workflow"><i class="fa fa-check"></i><b>6.3.1</b> VI Workflow</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="georeferencing-plot-trees.html"><a href="georeferencing-plot-trees.html"><i class="fa fa-check"></i><b>7</b> Georeferencing Plot Trees</a></li>
<li class="chapter" data-level="8" data-path="crown-delineation.html"><a href="crown-delineation.html"><i class="fa fa-check"></i><b>8</b> Crown delineation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="crown-delineation.html"><a href="crown-delineation.html#circles-proportional-to-tree-height."><i class="fa fa-check"></i><b>8.1</b> Circles Proportional to Tree Height.</a></li>
<li class="chapter" data-level="8.2" data-path="crown-delineation.html"><a href="crown-delineation.html#supercell-raster"><i class="fa fa-check"></i><b>8.2</b> Supercell Raster</a></li>
<li class="chapter" data-level="8.3" data-path="crown-delineation.html"><a href="crown-delineation.html#filter-merge-supercells"><i class="fa fa-check"></i><b>8.3</b> Filter &amp; Merge Supercells</a></li>
<li class="chapter" data-level="8.4" data-path="crown-delineation.html"><a href="crown-delineation.html#manually-edite-crowns"><i class="fa fa-check"></i><b>8.4</b> Manually Edite Crowns</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html"><i class="fa fa-check"></i><b>9</b> LiDAR Processing Workflow</a>
<ul>
<li class="chapter" data-level="9.1" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#dji-terra"><i class="fa fa-check"></i><b>9.1</b> DJI Terra</a></li>
<li class="chapter" data-level="9.2" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#register-the-lidar-to-the-dap-point-cloud"><i class="fa fa-check"></i><b>9.2</b> Register the LiDAR to the DAP point cloud</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#prepare-lidar-for-registration"><i class="fa fa-check"></i><b>9.2.1</b> Prepare LiDAR for registration</a></li>
<li class="chapter" data-level="9.2.2" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#register-lidar-to-dap-cloud-in-cloudcompare"><i class="fa fa-check"></i><b>9.2.2</b> Register LiDAR to DAP cloud in CloudCompare</a></li>
<li class="chapter" data-level="9.2.3" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#rescale-and-tile-the-registered-lidar"><i class="fa fa-check"></i><b>9.2.3</b> Rescale and tile the registered LiDAR:</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#normalization-and-individual-tree-point-clouds"><i class="fa fa-check"></i><b>9.3</b> Normalization and individual tree point clouds</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#creating-a-dtm-from-the-registered-lidar-tiles"><i class="fa fa-check"></i><b>9.3.1</b> Creating a DTM from the registered LiDAR tiles</a></li>
<li class="chapter" data-level="9.3.2" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#normalizing-the-tiles-using-the-dtm"><i class="fa fa-check"></i><b>9.3.2</b> Normalizing the tiles using the DTM</a></li>
<li class="chapter" data-level="9.3.3" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#creating-a-4cm-chm-from-the-max-z-values"><i class="fa fa-check"></i><b>9.3.3</b> Creating a 4cm CHM from the max Z values</a></li>
<li class="chapter" data-level="9.3.4" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#segmenting-tiles"><i class="fa fa-check"></i><b>9.3.4</b> Segmenting tiles</a></li>
<li class="chapter" data-level="9.3.5" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#merging-segmented-tiles-to-create-one-large-point-cloud-containing-the-top-defined-height-of-each-tree"><i class="fa fa-check"></i><b>9.3.5</b> Merging segmented tiles to create one large point cloud containing the top defined height % of each tree</a></li>
<li class="chapter" data-level="9.3.6" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#clipping-the-point-cloud-into-individual-point-clouds-per-tree"><i class="fa fa-check"></i><b>9.3.6</b> Clipping the point cloud into individual point clouds per tree</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="lidar-processing-workflow.html"><a href="lidar-processing-workflow.html#individual-tree-metrics"><i class="fa fa-check"></i><b>9.4</b> Individual Tree Metrics</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html"><i class="fa fa-check"></i><b>10</b> MicaSense Irradiance Correction</a>
<ul>
<li class="chapter" data-level="10.1" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html#background"><i class="fa fa-check"></i><b>10.1</b> Background</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html#deriving-horizontal-irradiance"><i class="fa fa-check"></i><b>10.1.1</b> Deriving Horizontal Irradiance</a></li>
<li class="chapter" data-level="10.1.2" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html#calculating-reflectance"><i class="fa fa-check"></i><b>10.1.2</b> Calculating Reflectance</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html#the-problem"><i class="fa fa-check"></i><b>10.2</b> The Problem</a></li>
<li class="chapter" data-level="10.3" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html#is-correction-needed"><i class="fa fa-check"></i><b>10.3</b> Is Correction Needed?</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html#do-the-sun-sensor-angles-make-sense"><i class="fa fa-check"></i><b>10.3.1</b> Do the sun sensor angles make sense?</a></li>
<li class="chapter" data-level="10.3.2" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html#does-the-relationship-between-direct-and-horizontal-irradiance-make-sense"><i class="fa fa-check"></i><b>10.3.2</b> Does the relationship between direct and horizontal irradiance make sense?</a></li>
<li class="chapter" data-level="10.3.3" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html#does-the-scattered-direct-ratio-make-sense-for-the-lighting-conditions-of-that-day"><i class="fa fa-check"></i><b>10.3.3</b> Does the scattered: direct ratio make sense for the lighting conditions of that day?</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html#correcting-irradiance-values-for-micasense-cameras"><i class="fa fa-check"></i><b>10.4</b> Correcting Irradiance Values for Micasense Cameras</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html#reading-exif-data"><i class="fa fa-check"></i><b>10.4.1</b> Reading Exif Data</a></li>
<li class="chapter" data-level="10.4.2" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html#calculating-solar-zenith-anlge"><i class="fa fa-check"></i><b>10.4.2</b> Calculating Solar Zenith Anlge</a></li>
<li class="chapter" data-level="10.4.3" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html#caluclating-sun-sensor-angles"><i class="fa fa-check"></i><b>10.4.3</b> Caluclating Sun-Sensor Angles</a></li>
<li class="chapter" data-level="10.4.4" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html#scattereddirect-ratio-estimate"><i class="fa fa-check"></i><b>10.4.4</b> Scattered:Direct Ratio Estimate</a></li>
<li class="chapter" data-level="10.4.5" data-path="micasense-irradiance-correction.html"><a href="micasense-irradiance-correction.html#computing-horizontal-corrected-irradiance"><i class="fa fa-check"></i><b>10.4.5</b> Computing Horizontal (Corrected) Irradiance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="thermal-conversion.html"><a href="thermal-conversion.html"><i class="fa fa-check"></i><b>11</b> Thermal Conversion</a>
<ul>
<li class="chapter" data-level="11.1" data-path="thermal-conversion.html"><a href="thermal-conversion.html#folder-set-up"><i class="fa fa-check"></i><b>11.1</b> Folder Set-Up</a></li>
<li class="chapter" data-level="11.2" data-path="thermal-conversion.html"><a href="thermal-conversion.html#weather-data"><i class="fa fa-check"></i><b>11.2</b> Weather Data</a></li>
<li class="chapter" data-level="11.3" data-path="thermal-conversion.html"><a href="thermal-conversion.html#dji-thermal-sdk-temperature-conversion"><i class="fa fa-check"></i><b>11.3</b> DJI Thermal SDK: temperature conversion</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="thermal-conversion.html"><a href="thermal-conversion.html#parameters"><i class="fa fa-check"></i><b>11.3.1</b> Parameters</a></li>
<li class="chapter" data-level="11.3.2" data-path="thermal-conversion.html"><a href="thermal-conversion.html#running-the-sdk"><i class="fa fa-check"></i><b>11.3.2</b> Running the SDK</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="thermal-conversion.html"><a href="thermal-conversion.html#convert-to-raster"><i class="fa fa-check"></i><b>11.4</b> Convert to Raster</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Guidelines and Procedures for Drone Based Phenotyping in Forest Research Trials</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="crown-delineation" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Crown delineation<a href="crown-delineation.html#crown-delineation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We are using supercells to create delineated crowns using:</p>
<ol style="list-style-type: decimal">
<li><p>A shapefile (.shp) with a grid of tree locations derived by georeferencing the census data to the imagery. This will be referred to as the “grid”. Detailed steps for creating the grid can be found in the <a href="0_Tree_Georeferencing#Georeferencing%20Plot%20Trees">Georeferencing Plot Trees</a> chapter</p></li>
<li><p>Co-registered CHM made from normalized maximum elevation (Z) values, MicaSense orthomosaic, and P1 orthomosaic, ideally from the same date.</p></li>
</ol>
<p>The R code contains commented sections where manual editing in a GIS is required. Below steps starting with (R) are steps done in the R code and (GIS) are steps requiring editing in a GIS such as QGIS or ArcGIS. The R code does the following:</p>
<ul>
<li><ol start="18" style="list-style-type: upper-alpha">
<li>The grid treetop points are buffered by 30-40cm, and using the CHM, the grid is snapped to the maximum value within this circle.</li>
</ol></li>
<li><p>(GIS) Check the location of the treetops to the P1 orthomosaic and manual move treetops to align with trees in the P1 orthomosaic where necessary.</p></li>
<li><ol start="18" style="list-style-type: upper-alpha">
<li>Load in manually edited treetops, create circles proportional to tree height.</li>
</ol></li>
<li><ol start="18" style="list-style-type: upper-alpha">
<li>Create a supercell segmentation raster using the CHM and MicaSense and P1 orthomosaics</li>
</ol></li>
<li><ol start="18" style="list-style-type: upper-alpha">
<li>Filter out segments that do not touch any of the circles proportional to tree height</li>
</ol></li>
<li><ol start="18" style="list-style-type: upper-alpha">
<li>Merge remaining segments to create crown polygons</li>
</ol></li>
<li><p>(GIS) Load into a GIS, along with the edited treetops and P1 orthomosaic, and edit the crown polygons to remove sections where neighbouring branches intersect the crown to ensure the crowns contain only data from the correct tree. Obscured trees are given a crown confidence score and can be removed at analysis. This is the most manually time-consuming process in the whole project.</p></li>
</ul>
<div id="circles-proportional-to-tree-height." class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Circles Proportional to Tree Height.<a href="crown-delineation.html#circles-proportional-to-tree-height." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Inputs:
1) CHM
2) manually edited grid points</p>
<p>Outputs:
1) Buffered grid points shapefile
2) Circles Proportional to 9th height percentile shp</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="crown-delineation.html#cb16-1" tabindex="-1"></a>site <span class="ot">&lt;-</span> <span class="st">&quot;Fdc_JR_East_GCA&quot;</span> </span>
<span id="cb16-2"><a href="crown-delineation.html#cb16-2" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Q:</span><span class="sc">\\</span><span class="st">SNC</span><span class="sc">\\</span><span class="st">Data</span><span class="sc">\\</span><span class="st">&quot;</span>,site,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">Site_Info</span><span class="sc">\\</span><span class="st">03_GIS</span><span class="sc">\\</span><span class="st">shapefiles</span><span class="sc">\\</span><span class="st">&quot;</span>)</span>
<span id="cb16-3"><a href="crown-delineation.html#cb16-3" tabindex="-1"></a>edited_grid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dir,<span class="st">&quot;Edited_Fdc_JR_East_GCA_ttops_0.3mBuffers_.shp&quot;</span>)</span>
<span id="cb16-4"><a href="crown-delineation.html#cb16-4" tabindex="-1"></a></span>
<span id="cb16-5"><a href="crown-delineation.html#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="crown-delineation.html#cb16-6" tabindex="-1"></a>CHM_L1 <span class="ot">&lt;-</span> <span class="st">&quot;path to CHM&quot;</span></span>
<span id="cb16-7"><a href="crown-delineation.html#cb16-7" tabindex="-1"></a>CHM_max_L1 <span class="ot">&lt;-</span> <span class="fu">rast</span>(CHM_L1)</span>
<span id="cb16-8"><a href="crown-delineation.html#cb16-8" tabindex="-1"></a></span>
<span id="cb16-9"><a href="crown-delineation.html#cb16-9" tabindex="-1"></a></span>
<span id="cb16-10"><a href="crown-delineation.html#cb16-10" tabindex="-1"></a>crown_dir <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Q:</span><span class="sc">\\</span><span class="st">SNC</span><span class="sc">\\</span><span class="st">Data</span><span class="sc">\\</span><span class="st">&quot;</span>,site,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">Site_Info</span><span class="sc">\\</span><span class="st">GIS</span><span class="sc">\\</span><span class="st">shapefiles</span><span class="sc">\\</span><span class="st">Crowns</span><span class="sc">\\</span><span class="st">&quot;</span>)</span>
<span id="cb16-11"><a href="crown-delineation.html#cb16-11" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(crown_dir)){</span>
<span id="cb16-12"><a href="crown-delineation.html#cb16-12" tabindex="-1"></a>  <span class="fu">dir.create</span>(crown_dir)</span>
<span id="cb16-13"><a href="crown-delineation.html#cb16-13" tabindex="-1"></a>}</span>
<span id="cb16-14"><a href="crown-delineation.html#cb16-14" tabindex="-1"></a></span>
<span id="cb16-15"><a href="crown-delineation.html#cb16-15" tabindex="-1"></a><span class="co"># read in the treetops as an sp object</span></span>
<span id="cb16-16"><a href="crown-delineation.html#cb16-16" tabindex="-1"></a>ttops <span class="ot">&lt;-</span> <span class="fu">st_read</span>(edited_grid)</span>
<span id="cb16-17"><a href="crown-delineation.html#cb16-17" tabindex="-1"></a>ttops<span class="ot">&lt;-</span> ttops<span class="sc">%&gt;%</span></span>
<span id="cb16-18"><a href="crown-delineation.html#cb16-18" tabindex="-1"></a>  <span class="fu">st_centroid</span>()</span>
<span id="cb16-19"><a href="crown-delineation.html#cb16-19" tabindex="-1"></a></span>
<span id="cb16-20"><a href="crown-delineation.html#cb16-20" tabindex="-1"></a><span class="co"># Get heights from a circle around each ttops:</span></span>
<span id="cb16-21"><a href="crown-delineation.html#cb16-21" tabindex="-1"></a><span class="co"># Create a buffer around each centroid with a radius of 30cm (0.3 meters)</span></span>
<span id="cb16-22"><a href="crown-delineation.html#cb16-22" tabindex="-1"></a>buffer_radius <span class="ot">&lt;-</span> <span class="fl">0.1</span>  <span class="co"># in meters</span></span>
<span id="cb16-23"><a href="crown-delineation.html#cb16-23" tabindex="-1"></a>ttops_buffered <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(ttops, <span class="at">dist =</span> buffer_radius)</span>
<span id="cb16-24"><a href="crown-delineation.html#cb16-24" tabindex="-1"></a><span class="fu">plot</span>(ttops_buffered<span class="sc">$</span>geometry, <span class="at">add =</span> <span class="cn">TRUE</span>,<span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb16-25"><a href="crown-delineation.html#cb16-25" tabindex="-1"></a></span>
<span id="cb16-26"><a href="crown-delineation.html#cb16-26" tabindex="-1"></a><span class="co">#Check geometries, this should be  = 0</span></span>
<span id="cb16-27"><a href="crown-delineation.html#cb16-27" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">st_is_valid</span>(ttops_buffered))</span>
<span id="cb16-28"><a href="crown-delineation.html#cb16-28" tabindex="-1"></a></span>
<span id="cb16-29"><a href="crown-delineation.html#cb16-29" tabindex="-1"></a><span class="co">#Check crs info</span></span>
<span id="cb16-30"><a href="crown-delineation.html#cb16-30" tabindex="-1"></a><span class="fu">crs</span>(CHM_max_L1) </span>
<span id="cb16-31"><a href="crown-delineation.html#cb16-31" tabindex="-1"></a><span class="fu">st_crs</span>(ttops_buffered)</span>
<span id="cb16-32"><a href="crown-delineation.html#cb16-32" tabindex="-1"></a></span>
<span id="cb16-33"><a href="crown-delineation.html#cb16-33" tabindex="-1"></a>ttops_buffered <span class="ot">&lt;-</span> ttops_buffered[<span class="sc">!</span><span class="fu">st_is_empty</span>(ttops_buffered), ]</span>
<span id="cb16-34"><a href="crown-delineation.html#cb16-34" tabindex="-1"></a></span>
<span id="cb16-35"><a href="crown-delineation.html#cb16-35" tabindex="-1"></a><span class="co"># Height Quantile from CHM</span></span>
<span id="cb16-36"><a href="crown-delineation.html#cb16-36" tabindex="-1"></a>extracted_values <span class="ot">=</span> ttops_buffered <span class="sc">%&gt;%</span></span>
<span id="cb16-37"><a href="crown-delineation.html#cb16-37" tabindex="-1"></a>  <span class="fu">exact_extract</span>(<span class="at">x =</span> CHM_max_L1,</span>
<span id="cb16-38"><a href="crown-delineation.html#cb16-38" tabindex="-1"></a>                <span class="at">y =</span> .,</span>
<span id="cb16-39"><a href="crown-delineation.html#cb16-39" tabindex="-1"></a>                <span class="at">fun =</span> <span class="st">&quot;quantile&quot;</span>,</span>
<span id="cb16-40"><a href="crown-delineation.html#cb16-40" tabindex="-1"></a>                <span class="at">quantiles =</span> <span class="fu">c</span>(<span class="fl">0.975</span>, <span class="fl">0.99</span>),</span>
<span id="cb16-41"><a href="crown-delineation.html#cb16-41" tabindex="-1"></a>                <span class="at">force_df =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-42"><a href="crown-delineation.html#cb16-42" tabindex="-1"></a>                <span class="at">append_cols =</span> <span class="fu">c</span>(<span class="st">&quot;TAG&quot;</span>))</span>
<span id="cb16-43"><a href="crown-delineation.html#cb16-43" tabindex="-1"></a></span>
<span id="cb16-44"><a href="crown-delineation.html#cb16-44" tabindex="-1"></a><span class="co"># Assign the pixel IDs to each polygon</span></span>
<span id="cb16-45"><a href="crown-delineation.html#cb16-45" tabindex="-1"></a>ttops_zq99 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(ttops_buffered, extracted_values, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;TAG&quot;</span>))</span>
<span id="cb16-46"><a href="crown-delineation.html#cb16-46" tabindex="-1"></a></span>
<span id="cb16-47"><a href="crown-delineation.html#cb16-47" tabindex="-1"></a><span class="co"># Checking heights look correct</span></span>
<span id="cb16-48"><a href="crown-delineation.html#cb16-48" tabindex="-1"></a><span class="co"># Fit a linear regression model</span></span>
<span id="cb16-49"><a href="crown-delineation.html#cb16-49" tabindex="-1"></a>ttops_buffered_plot <span class="ot">&lt;-</span> ttops_zq99 <span class="sc">%&gt;%</span></span>
<span id="cb16-50"><a href="crown-delineation.html#cb16-50" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(HT2021),</span>
<span id="cb16-51"><a href="crown-delineation.html#cb16-51" tabindex="-1"></a>         HT2021 <span class="sc">&gt;</span> <span class="dv">2</span>)</span>
<span id="cb16-52"><a href="crown-delineation.html#cb16-52" tabindex="-1"></a><span class="fu">plot</span>(ttops_buffered_plot<span class="sc">$</span>geometry)</span>
<span id="cb16-53"><a href="crown-delineation.html#cb16-53" tabindex="-1"></a></span>
<span id="cb16-54"><a href="crown-delineation.html#cb16-54" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(q99 <span class="sc">~</span> HT2021, <span class="at">data =</span> ttops_buffered_plot)</span>
<span id="cb16-55"><a href="crown-delineation.html#cb16-55" tabindex="-1"></a><span class="co"># Get the R-squared value</span></span>
<span id="cb16-56"><a href="crown-delineation.html#cb16-56" tabindex="-1"></a>(r_squared <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)<span class="sc">$</span>r.squared)</span>
<span id="cb16-57"><a href="crown-delineation.html#cb16-57" tabindex="-1"></a></span>
<span id="cb16-58"><a href="crown-delineation.html#cb16-58" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ttops_buffered_plot, <span class="fu">aes</span>(<span class="at">x =</span> HT2021, <span class="at">y =</span> q99)) <span class="sc">+</span></span>
<span id="cb16-59"><a href="crown-delineation.html#cb16-59" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="at">formula =</span> y <span class="sc">~</span> x) <span class="sc">+</span></span>
<span id="cb16-60"><a href="crown-delineation.html#cb16-60" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">&quot;buffer_radius: &quot;</span>, buffer_radius, <span class="st">&quot;m&quot;</span>))<span class="sc">+</span></span>
<span id="cb16-61"><a href="crown-delineation.html#cb16-61" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb16-62"><a href="crown-delineation.html#cb16-62" tabindex="-1"></a></span>
<span id="cb16-63"><a href="crown-delineation.html#cb16-63" tabindex="-1"></a><span class="co"># Saving out shp of buffered points</span></span>
<span id="cb16-64"><a href="crown-delineation.html#cb16-64" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">paste0</span>(crown_dir,<span class="st">&quot;Buffer_radius_ttops_&quot;</span>,buffer_radius))){</span>
<span id="cb16-65"><a href="crown-delineation.html#cb16-65" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(crown_dir,<span class="st">&quot;Buffer_radius_ttops_&quot;</span>,buffer_radius))</span>
<span id="cb16-66"><a href="crown-delineation.html#cb16-66" tabindex="-1"></a>}</span>
<span id="cb16-67"><a href="crown-delineation.html#cb16-67" tabindex="-1"></a><span class="fu">st_write</span>(ttops_zq99, <span class="fu">paste0</span>(crown_dir,<span class="st">&quot;Buffer_radius_ttops_&quot;</span>,buffer_radius,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">&quot;</span>,site,<span class="st">&quot;_ttops_&quot;</span>,buffer_radius,<span class="st">&quot;mBuffers_.shp&quot;</span>), </span>
<span id="cb16-68"><a href="crown-delineation.html#cb16-68" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-69"><a href="crown-delineation.html#cb16-69" tabindex="-1"></a></span>
<span id="cb16-70"><a href="crown-delineation.html#cb16-70" tabindex="-1"></a><span class="co"># Proportional hulls based on 99th percentile</span></span>
<span id="cb16-71"><a href="crown-delineation.html#cb16-71" tabindex="-1"></a>percent <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb16-72"><a href="crown-delineation.html#cb16-72" tabindex="-1"></a>(buffer_dist <span class="ot">&lt;-</span> ttops_zq99<span class="sc">$</span>q99 <span class="sc">*</span> (percent<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb16-73"><a href="crown-delineation.html#cb16-73" tabindex="-1"></a><span class="fu">length</span>(buffer_dist)</span>
<span id="cb16-74"><a href="crown-delineation.html#cb16-74" tabindex="-1"></a></span>
<span id="cb16-75"><a href="crown-delineation.html#cb16-75" tabindex="-1"></a>buffer_dist[<span class="fu">is.na</span>(buffer_dist)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-76"><a href="crown-delineation.html#cb16-76" tabindex="-1"></a></span>
<span id="cb16-77"><a href="crown-delineation.html#cb16-77" tabindex="-1"></a>prop_hulls <span class="ot">&lt;-</span> ttops_zq99<span class="sc">%&gt;%</span></span>
<span id="cb16-78"><a href="crown-delineation.html#cb16-78" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">26910</span>)<span class="sc">%&gt;%</span></span>
<span id="cb16-79"><a href="crown-delineation.html#cb16-79" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> buffer_dist)<span class="sc">%&gt;%</span> <span class="co">#value here is radius</span></span>
<span id="cb16-80"><a href="crown-delineation.html#cb16-80" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">buff =</span> buffer_dist)</span>
<span id="cb16-81"><a href="crown-delineation.html#cb16-81" tabindex="-1"></a></span>
<span id="cb16-82"><a href="crown-delineation.html#cb16-82" tabindex="-1"></a>(prop_hulls<span class="sc">$</span>crownArea <span class="ot">&lt;-</span> <span class="fu">st_area</span>(prop_hulls))</span>
<span id="cb16-83"><a href="crown-delineation.html#cb16-83" tabindex="-1"></a></span>
<span id="cb16-84"><a href="crown-delineation.html#cb16-84" tabindex="-1"></a><span class="fu">plot</span>(prop_hulls<span class="sc">$</span>geometry)</span>
<span id="cb16-85"><a href="crown-delineation.html#cb16-85" tabindex="-1"></a></span>
<span id="cb16-86"><a href="crown-delineation.html#cb16-86" tabindex="-1"></a><span class="fu">st_write</span>(prop_hulls, <span class="fu">paste0</span>(crown_dir,<span class="st">&quot;Buffer_radius_ttops_&quot;</span>,buffer_radius,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">&quot;</span>,site,<span class="st">&quot;_proportional_Hulls_Diam&quot;</span>,percent,<span class="st">&quot;percent_zq99.shp&quot;</span>), </span>
<span id="cb16-87"><a href="crown-delineation.html#cb16-87" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-88"><a href="crown-delineation.html#cb16-88" tabindex="-1"></a></span>
<span id="cb16-89"><a href="crown-delineation.html#cb16-89" tabindex="-1"></a>(na_counts <span class="ot">&lt;-</span> <span class="fu">colSums</span>(<span class="fu">is.na</span>(prop_hulls)))</span>
<span id="cb16-90"><a href="crown-delineation.html#cb16-90" tabindex="-1"></a><span class="co"># Remove unnecessary columns with lots of NAs from above</span></span>
<span id="cb16-91"><a href="crown-delineation.html#cb16-91" tabindex="-1"></a></span>
<span id="cb16-92"><a href="crown-delineation.html#cb16-92" tabindex="-1"></a><span class="fu">colnames</span>(prop_hulls)</span>
<span id="cb16-93"><a href="crown-delineation.html#cb16-93" tabindex="-1"></a>prop_hulls_forSEG <span class="ot">&lt;-</span> prop_hulls <span class="sc">%&gt;%</span></span>
<span id="cb16-94"><a href="crown-delineation.html#cb16-94" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(TAG, row, col, q99, q97, crownArea)) <span class="co">#has lots of NAs that throw errors for below seg1, seg1 below removes rows with NA values, so make sure to take out columns with lots of NAs here if theyre not needed below</span></span>
<span id="cb16-95"><a href="crown-delineation.html#cb16-95" tabindex="-1"></a></span>
<span id="cb16-96"><a href="crown-delineation.html#cb16-96" tabindex="-1"></a><span class="fu">plot</span>(prop_hulls_forSEG<span class="sc">$</span>geometry)</span>
<span id="cb16-97"><a href="crown-delineation.html#cb16-97" tabindex="-1"></a></span>
<span id="cb16-98"><a href="crown-delineation.html#cb16-98" tabindex="-1"></a><span class="fu">st_write</span>(prop_hulls_forSEG, <span class="fu">paste0</span>(crown_dir,<span class="st">&quot;Buffer_radius_ttops_&quot;</span>,buffer_radius,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">&quot;</span>,site,<span class="st">&quot;_proportional_Hulls_Diam&quot;</span>,percent,<span class="st">&quot;percent_zq99_forSEG_.shp&quot;</span>), </span>
<span id="cb16-99"><a href="crown-delineation.html#cb16-99" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-100"><a href="crown-delineation.html#cb16-100" tabindex="-1"></a></span>
<span id="cb16-101"><a href="crown-delineation.html#cb16-101" tabindex="-1"></a>(na_counts <span class="ot">&lt;-</span> <span class="fu">colSums</span>(<span class="fu">is.na</span>(prop_hulls_forSEG)))</span></code></pre></div>
</div>
<div id="supercell-raster" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Supercell Raster<a href="crown-delineation.html#supercell-raster" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="crown-delineation.html#cb17-1" tabindex="-1"></a><span class="fu">library</span>(future)</span>
<span id="cb17-2"><a href="crown-delineation.html#cb17-2" tabindex="-1"></a><span class="fu">library</span>(supercells)</span>
<span id="cb17-3"><a href="crown-delineation.html#cb17-3" tabindex="-1"></a><span class="fu">library</span>(RStoolbox)</span>
<span id="cb17-4"><a href="crown-delineation.html#cb17-4" tabindex="-1"></a><span class="co">#FDC East:</span></span>
<span id="cb17-5"><a href="crown-delineation.html#cb17-5" tabindex="-1"></a>ms_path <span class="ot">&lt;-</span> <span class="st">&quot;Q:</span><span class="sc">\\</span><span class="st">SNC</span><span class="sc">\\</span><span class="st">Data</span><span class="sc">\\</span><span class="st">Fdc_JR_East_GCA</span><span class="sc">\\</span><span class="st">Flights</span><span class="sc">\\</span><span class="st">2024_03_13</span><span class="sc">\\</span><span class="st">2_Inputs</span><span class="sc">\\</span><span class="st">metashape</span><span class="sc">\\</span><span class="st">3_MS_ORTHO</span><span class="sc">\\</span><span class="st">Fdc_JR_East_GCA_2024_03_13_Calp15p1049_MS.tif&quot;</span></span>
<span id="cb17-6"><a href="crown-delineation.html#cb17-6" tabindex="-1"></a>p1_path <span class="ot">&lt;-</span> <span class="st">&quot;Q:</span><span class="sc">\\</span><span class="st">SNC</span><span class="sc">\\</span><span class="st">Data</span><span class="sc">\\</span><span class="st">Fdc_JR_East_GCA</span><span class="sc">\\</span><span class="st">Flights</span><span class="sc">\\</span><span class="st">2024_03_13</span><span class="sc">\\</span><span class="st">2_Inputs</span><span class="sc">\\</span><span class="st">metashape</span><span class="sc">\\</span><span class="st">2_ORTHO</span><span class="sc">\\</span><span class="st">Fdc_East_2024_03_13_P1_Aligned_Surrogate.tif&quot;</span></span>
<span id="cb17-7"><a href="crown-delineation.html#cb17-7" tabindex="-1"></a></span>
<span id="cb17-8"><a href="crown-delineation.html#cb17-8" tabindex="-1"></a></span>
<span id="cb17-9"><a href="crown-delineation.html#cb17-9" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-10"><a href="crown-delineation.html#cb17-10" tabindex="-1"></a><span class="co"># ms_path &lt;- &quot;Q:\\SNC\\Data\\Hillcrest_GCA\\Flights\\2024_03_15\\2_Inputs\\metashape\\3_MS_ORTHO\\Hillcrest_GCA_2024_03_15_MS_noCor_Calp13p1562.tif&quot;</span></span>
<span id="cb17-11"><a href="crown-delineation.html#cb17-11" tabindex="-1"></a><span class="co"># p1_path &lt;- &quot;Q:\\SNC\\Data\\Hillcrest_GCA\\Flights\\2024_03_15\\2_Inputs\\metashape\\2_ORTHO\\Hillcrest_P1_240315_noCor_high.tif&quot;</span></span>
<span id="cb17-12"><a href="crown-delineation.html#cb17-12" tabindex="-1"></a><span class="co"># # ms_P_path &lt;- &quot;Q:\\SNC\\Data\\Big_Tree_GCA\\Flights\\2024_03_19\\2_Inputs\\metashape\\3_MS_ORTHO\\Fdc_Big_Tree_2024_03_19_PPP_PPK_Calp20p1083_MS_P.tif&quot;</span></span>
<span id="cb17-13"><a href="crown-delineation.html#cb17-13" tabindex="-1"></a></span>
<span id="cb17-14"><a href="crown-delineation.html#cb17-14" tabindex="-1"></a>test_folder <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb17-15"><a href="crown-delineation.html#cb17-15" tabindex="-1"></a></span>
<span id="cb17-16"><a href="crown-delineation.html#cb17-16" tabindex="-1"></a>prop_hulls <span class="ot">&lt;-</span> <span class="fu">paste0</span>(crown_dir,<span class="st">&quot;Buffer_radius_ttops_&quot;</span>,buffer_radius,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">&quot;</span>,site,<span class="st">&quot;_proportional_Hulls_Diam&quot;</span>,percent,<span class="st">&quot;percent_zq99_forSEG_.shp&quot;</span>)</span>
<span id="cb17-17"><a href="crown-delineation.html#cb17-17" tabindex="-1"></a></span>
<span id="cb17-18"><a href="crown-delineation.html#cb17-18" tabindex="-1"></a><span class="co"># bound = grid_buf</span></span>
<span id="cb17-19"><a href="crown-delineation.html#cb17-19" tabindex="-1"></a>Hulls <span class="ot">=</span> <span class="fu">st_read</span>(prop_hulls) <span class="sc">%&gt;%</span></span>
<span id="cb17-20"><a href="crown-delineation.html#cb17-20" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">26910</span>)</span>
<span id="cb17-21"><a href="crown-delineation.html#cb17-21" tabindex="-1"></a></span>
<span id="cb17-22"><a href="crown-delineation.html#cb17-22" tabindex="-1"></a><span class="co">#buffer hulls by 5m to get a bounding box to trim rasters with</span></span>
<span id="cb17-23"><a href="crown-delineation.html#cb17-23" tabindex="-1"></a>bound <span class="ot">=</span> Hulls <span class="sc">%&gt;%</span></span>
<span id="cb17-24"><a href="crown-delineation.html#cb17-24" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">5</span>)</span>
<span id="cb17-25"><a href="crown-delineation.html#cb17-25" tabindex="-1"></a></span>
<span id="cb17-26"><a href="crown-delineation.html#cb17-26" tabindex="-1"></a><span class="fu">plot</span>(CHM_max_L1)</span>
<span id="cb17-27"><a href="crown-delineation.html#cb17-27" tabindex="-1"></a><span class="fu">plot</span>(Hulls<span class="sc">$</span>geometry, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-28"><a href="crown-delineation.html#cb17-28" tabindex="-1"></a><span class="co">#plot(rast(ms_ortho))</span></span>
<span id="cb17-29"><a href="crown-delineation.html#cb17-29" tabindex="-1"></a><span class="co"># Raster to input to make supercells</span></span>
<span id="cb17-30"><a href="crown-delineation.html#cb17-30" tabindex="-1"></a>CHM_max_L1 <span class="ot">=</span> <span class="fu">rast</span>(CHM_L1) <span class="sc">%&gt;%</span></span>
<span id="cb17-31"><a href="crown-delineation.html#cb17-31" tabindex="-1"></a>  <span class="co"># terra::focal(w = 3, fun = &quot;median&quot;, na.policy = &quot;only&quot;, na.rm = TRUE) %&gt;%</span></span>
<span id="cb17-32"><a href="crown-delineation.html#cb17-32" tabindex="-1"></a>  <span class="co"># terra::focal(w = 3, fun = &quot;median&quot;, na.policy = &quot;only&quot;, na.rm = TRUE) %&gt;%</span></span>
<span id="cb17-33"><a href="crown-delineation.html#cb17-33" tabindex="-1"></a>  <span class="co"># resample(CHM_max_L2) %&gt;%</span></span>
<span id="cb17-34"><a href="crown-delineation.html#cb17-34" tabindex="-1"></a>  <span class="fu">crop</span>(bound) <span class="sc">%&gt;%</span></span>
<span id="cb17-35"><a href="crown-delineation.html#cb17-35" tabindex="-1"></a>  <span class="fu">trim</span>()</span>
<span id="cb17-36"><a href="crown-delineation.html#cb17-36" tabindex="-1"></a></span>
<span id="cb17-37"><a href="crown-delineation.html#cb17-37" tabindex="-1"></a></span>
<span id="cb17-38"><a href="crown-delineation.html#cb17-38" tabindex="-1"></a>ms_ortho <span class="ot">=</span> <span class="fu">rast</span>(ms_path)[[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>,<span class="dv">9</span>)]] <span class="sc">%&gt;%</span> </span>
<span id="cb17-39"><a href="crown-delineation.html#cb17-39" tabindex="-1"></a>  <span class="fu">resample</span>(CHM_max_L1, <span class="at">method =</span> <span class="st">&quot;near&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-40"><a href="crown-delineation.html#cb17-40" tabindex="-1"></a>  <span class="fu">crop</span>(bound)<span class="sc">%&gt;%</span></span>
<span id="cb17-41"><a href="crown-delineation.html#cb17-41" tabindex="-1"></a>  trim</span>
<span id="cb17-42"><a href="crown-delineation.html#cb17-42" tabindex="-1"></a></span>
<span id="cb17-43"><a href="crown-delineation.html#cb17-43" tabindex="-1"></a><span class="co"># ms_P_ortho = rast(ms_P_path)[[c(1,3,5)]] %&gt;% </span></span>
<span id="cb17-44"><a href="crown-delineation.html#cb17-44" tabindex="-1"></a><span class="co">#   resample(CHM_max_L1, method = &quot;near&quot;) %&gt;% </span></span>
<span id="cb17-45"><a href="crown-delineation.html#cb17-45" tabindex="-1"></a><span class="co">#   crop(bound)%&gt;%</span></span>
<span id="cb17-46"><a href="crown-delineation.html#cb17-46" tabindex="-1"></a><span class="co">#   trim</span></span>
<span id="cb17-47"><a href="crown-delineation.html#cb17-47" tabindex="-1"></a></span>
<span id="cb17-48"><a href="crown-delineation.html#cb17-48" tabindex="-1"></a>rgb <span class="ot">=</span> <span class="fu">rast</span>(p1_path)[[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb17-49"><a href="crown-delineation.html#cb17-49" tabindex="-1"></a>  <span class="fu">resample</span>(CHM_max_L1,<span class="at">method =</span> <span class="st">&quot;near&quot;</span>) <span class="sc">%&gt;%</span> <span class="co">#,</span></span>
<span id="cb17-50"><a href="crown-delineation.html#cb17-50" tabindex="-1"></a>  <span class="co"># rast(&quot;D:\\Sync\\_Sites\\Skimikin_spectral\\input\\ORTHO\\Skimikin_2021_08_14_RGB.tif&quot;)[[1:3]] %&gt;% </span></span>
<span id="cb17-51"><a href="crown-delineation.html#cb17-51" tabindex="-1"></a>  <span class="co">#   resample(CHM_max_2022_04_23)) %&gt;% </span></span>
<span id="cb17-52"><a href="crown-delineation.html#cb17-52" tabindex="-1"></a>  <span class="fu">crop</span>(bound) <span class="sc">%&gt;%</span></span>
<span id="cb17-53"><a href="crown-delineation.html#cb17-53" tabindex="-1"></a>  trim</span>
<span id="cb17-54"><a href="crown-delineation.html#cb17-54" tabindex="-1"></a></span>
<span id="cb17-55"><a href="crown-delineation.html#cb17-55" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ext</span>(ms_ortho))</span>
<span id="cb17-56"><a href="crown-delineation.html#cb17-56" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ext</span>(bound), <span class="at">col =</span> <span class="st">&quot;red&quot;</span> ,<span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-57"><a href="crown-delineation.html#cb17-57" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ext</span>(CHM_max_L1), <span class="at">col =</span> <span class="st">&quot;blue&quot;</span> ,<span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-58"><a href="crown-delineation.html#cb17-58" tabindex="-1"></a></span>
<span id="cb17-59"><a href="crown-delineation.html#cb17-59" tabindex="-1"></a><span class="fu">crs</span>(ms_ortho) <span class="ot">&lt;-</span> <span class="fu">crs</span>(CHM_max_L1) </span>
<span id="cb17-60"><a href="crown-delineation.html#cb17-60" tabindex="-1"></a><span class="fu">crs</span>(rgb)<span class="ot">&lt;-</span> <span class="fu">crs</span>(CHM_max_L1) </span>
<span id="cb17-61"><a href="crown-delineation.html#cb17-61" tabindex="-1"></a></span>
<span id="cb17-62"><a href="crown-delineation.html#cb17-62" tabindex="-1"></a><span class="fu">crs</span>(CHM_max_L1) <span class="sc">==</span> <span class="fu">crs</span>(ms_ortho)</span>
<span id="cb17-63"><a href="crown-delineation.html#cb17-63" tabindex="-1"></a></span>
<span id="cb17-64"><a href="crown-delineation.html#cb17-64" tabindex="-1"></a>use <span class="ot">=</span> <span class="fu">c</span>( </span>
<span id="cb17-65"><a href="crown-delineation.html#cb17-65" tabindex="-1"></a>  CHM_max_L1,</span>
<span id="cb17-66"><a href="crown-delineation.html#cb17-66" tabindex="-1"></a>  ms_ortho,</span>
<span id="cb17-67"><a href="crown-delineation.html#cb17-67" tabindex="-1"></a>  rgb)</span>
<span id="cb17-68"><a href="crown-delineation.html#cb17-68" tabindex="-1"></a></span>
<span id="cb17-69"><a href="crown-delineation.html#cb17-69" tabindex="-1"></a>use[use <span class="sc">&gt;</span> <span class="dv">60000</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb17-70"><a href="crown-delineation.html#cb17-70" tabindex="-1"></a></span>
<span id="cb17-71"><a href="crown-delineation.html#cb17-71" tabindex="-1"></a>use2 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">scale</span>(use)</span>
<span id="cb17-72"><a href="crown-delineation.html#cb17-72" tabindex="-1"></a></span>
<span id="cb17-73"><a href="crown-delineation.html#cb17-73" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">paste0</span>(crown_dir,<span class="st">&quot;Crown_segmentation</span><span class="sc">\\</span><span class="st">&quot;</span>))){</span>
<span id="cb17-74"><a href="crown-delineation.html#cb17-74" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(crown_dir,<span class="st">&quot;Crown_segmentation</span><span class="sc">\\</span><span class="st">&quot;</span>))</span>
<span id="cb17-75"><a href="crown-delineation.html#cb17-75" tabindex="-1"></a>}</span>
<span id="cb17-76"><a href="crown-delineation.html#cb17-76" tabindex="-1"></a></span>
<span id="cb17-77"><a href="crown-delineation.html#cb17-77" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">paste0</span>(crown_dir,<span class="st">&quot;Crown_segmentation&quot;</span>, test_folder,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">&quot;</span>))){</span>
<span id="cb17-78"><a href="crown-delineation.html#cb17-78" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(crown_dir,<span class="st">&quot;Crown_segmentation&quot;</span>, test_folder,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">&quot;</span>))</span>
<span id="cb17-79"><a href="crown-delineation.html#cb17-79" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Created&quot;</span>)</span>
<span id="cb17-80"><a href="crown-delineation.html#cb17-80" tabindex="-1"></a>}</span>
<span id="cb17-81"><a href="crown-delineation.html#cb17-81" tabindex="-1"></a></span>
<span id="cb17-82"><a href="crown-delineation.html#cb17-82" tabindex="-1"></a>crown_dir_folder <span class="ot">&lt;-</span> <span class="fu">paste0</span>(crown_dir,<span class="st">&quot;Crown_segmentation&quot;</span>, test_folder,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">&quot;</span>)</span>
<span id="cb17-83"><a href="crown-delineation.html#cb17-83" tabindex="-1"></a></span>
<span id="cb17-84"><a href="crown-delineation.html#cb17-84" tabindex="-1"></a><span class="fu">writeRaster</span>(use2, <span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;scaled_for_segments.tif&quot;</span>),</span>
<span id="cb17-85"><a href="crown-delineation.html#cb17-85" tabindex="-1"></a>            <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-86"><a href="crown-delineation.html#cb17-86" tabindex="-1"></a></span>
<span id="cb17-87"><a href="crown-delineation.html#cb17-87" tabindex="-1"></a>use3 <span class="ot">=</span> use2 <span class="sc">%&gt;%</span> </span>
<span id="cb17-88"><a href="crown-delineation.html#cb17-88" tabindex="-1"></a>  <span class="fu">ifel</span>(<span class="co">#CHM_max_L2 &lt; .25 &amp;</span></span>
<span id="cb17-89"><a href="crown-delineation.html#cb17-89" tabindex="-1"></a>    CHM_max_L1 <span class="sc">&lt;</span> .<span class="dv">25</span> , </span>
<span id="cb17-90"><a href="crown-delineation.html#cb17-90" tabindex="-1"></a>    <span class="cn">NA</span>, .)</span>
<span id="cb17-91"><a href="crown-delineation.html#cb17-91" tabindex="-1"></a></span>
<span id="cb17-92"><a href="crown-delineation.html#cb17-92" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> 6L)</span>
<span id="cb17-93"><a href="crown-delineation.html#cb17-93" tabindex="-1"></a></span>
<span id="cb17-94"><a href="crown-delineation.html#cb17-94" tabindex="-1"></a>seg <span class="ot">=</span> <span class="fu">supercells</span>(use3, <span class="at">step =</span> <span class="dv">6</span>, <span class="at">compactness =</span> <span class="dv">5</span>, <span class="at">iter =</span> <span class="dv">50</span>)</span>
<span id="cb17-95"><a href="crown-delineation.html#cb17-95" tabindex="-1"></a></span>
<span id="cb17-96"><a href="crown-delineation.html#cb17-96" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;HULLS&quot;</span>))){</span>
<span id="cb17-97"><a href="crown-delineation.html#cb17-97" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;HULLS&quot;</span>))</span>
<span id="cb17-98"><a href="crown-delineation.html#cb17-98" tabindex="-1"></a>}</span>
<span id="cb17-99"><a href="crown-delineation.html#cb17-99" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> dplyr<span class="sc">::</span><span class="fu">select</span>(seg, supercells, geometry), </span>
<span id="cb17-100"><a href="crown-delineation.html#cb17-100" tabindex="-1"></a>         <span class="at">dsn =</span> <span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;HULLS</span><span class="sc">\\</span><span class="st">&quot;</span>,site,<span class="st">&quot;_SEGS_step6_c5.shp&quot;</span>),</span>
<span id="cb17-101"><a href="crown-delineation.html#cb17-101" tabindex="-1"></a>         <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>,</span>
<span id="cb17-102"><a href="crown-delineation.html#cb17-102" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="filter-merge-supercells" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Filter &amp; Merge Supercells<a href="crown-delineation.html#filter-merge-supercells" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="crown-delineation.html#cb18-1" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb18-2"><a href="crown-delineation.html#cb18-2" tabindex="-1"></a><span class="co"># (6) Filter out polygons that don&#39;t touch the proportional height circles</span></span>
<span id="cb18-3"><a href="crown-delineation.html#cb18-3" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb18-4"><a href="crown-delineation.html#cb18-4" tabindex="-1"></a><span class="fu">library</span>(smoothr) <span class="co">#for fill_holes</span></span>
<span id="cb18-5"><a href="crown-delineation.html#cb18-5" tabindex="-1"></a></span>
<span id="cb18-6"><a href="crown-delineation.html#cb18-6" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;Prop_Diameter&quot;</span>,percent,<span class="st">&quot;%OfZq99&quot;</span>))){</span>
<span id="cb18-7"><a href="crown-delineation.html#cb18-7" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;Prop_Diameter&quot;</span>,percent,<span class="st">&quot;%OfZq99&quot;</span>))</span>
<span id="cb18-8"><a href="crown-delineation.html#cb18-8" tabindex="-1"></a>}</span>
<span id="cb18-9"><a href="crown-delineation.html#cb18-9" tabindex="-1"></a>seg <span class="ot">=</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;HULLS</span><span class="sc">\\</span><span class="st">&quot;</span>,site,<span class="st">&quot;_SEGS_step6_c5.shp&quot;</span>))</span>
<span id="cb18-10"><a href="crown-delineation.html#cb18-10" tabindex="-1"></a></span>
<span id="cb18-11"><a href="crown-delineation.html#cb18-11" tabindex="-1"></a></span>
<span id="cb18-12"><a href="crown-delineation.html#cb18-12" tabindex="-1"></a>chm_dat <span class="ot">=</span> <span class="fu">c</span>(CHM_max_L1<span class="co">#, </span></span>
<span id="cb18-13"><a href="crown-delineation.html#cb18-13" tabindex="-1"></a>            <span class="co">#CHM_max_L2</span></span>
<span id="cb18-14"><a href="crown-delineation.html#cb18-14" tabindex="-1"></a>)</span>
<span id="cb18-15"><a href="crown-delineation.html#cb18-15" tabindex="-1"></a><span class="fu">names</span>(chm_dat) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;CHM_max_L1&quot;</span><span class="co">#, </span></span>
<span id="cb18-16"><a href="crown-delineation.html#cb18-16" tabindex="-1"></a>                   <span class="co">#&quot;CHM_max_L2&quot;</span></span>
<span id="cb18-17"><a href="crown-delineation.html#cb18-17" tabindex="-1"></a>)</span>
<span id="cb18-18"><a href="crown-delineation.html#cb18-18" tabindex="-1"></a></span>
<span id="cb18-19"><a href="crown-delineation.html#cb18-19" tabindex="-1"></a>seg_extract <span class="ot">=</span> seg <span class="sc">%&gt;%</span> </span>
<span id="cb18-20"><a href="crown-delineation.html#cb18-20" tabindex="-1"></a>  <span class="fu">exact_extract</span>(<span class="at">x =</span> chm_dat,</span>
<span id="cb18-21"><a href="crown-delineation.html#cb18-21" tabindex="-1"></a>                <span class="at">y =</span> .,</span>
<span id="cb18-22"><a href="crown-delineation.html#cb18-22" tabindex="-1"></a>                <span class="at">fun =</span> <span class="st">&quot;max&quot;</span>,</span>
<span id="cb18-23"><a href="crown-delineation.html#cb18-23" tabindex="-1"></a>                <span class="at">force_df =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-24"><a href="crown-delineation.html#cb18-24" tabindex="-1"></a>                <span class="at">append_cols =</span> <span class="fu">c</span>(<span class="st">&quot;supercells&quot;</span>))</span>
<span id="cb18-25"><a href="crown-delineation.html#cb18-25" tabindex="-1"></a></span>
<span id="cb18-26"><a href="crown-delineation.html#cb18-26" tabindex="-1"></a><span class="fu">class</span>(seg_extract)</span>
<span id="cb18-27"><a href="crown-delineation.html#cb18-27" tabindex="-1"></a></span>
<span id="cb18-28"><a href="crown-delineation.html#cb18-28" tabindex="-1"></a>seg1 <span class="ot">=</span> <span class="fu">st_join</span>(seg, prop_hulls_forSEG) <span class="sc">%&gt;%</span> </span>
<span id="cb18-29"><a href="crown-delineation.html#cb18-29" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-30"><a href="crown-delineation.html#cb18-30" tabindex="-1"></a>  <span class="fu">group_by</span>(supercells) <span class="sc">%&gt;%</span> </span>
<span id="cb18-31"><a href="crown-delineation.html#cb18-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb18-32"><a href="crown-delineation.html#cb18-32" tabindex="-1"></a>  <span class="co"># rename(&quot;max_L1_poly&quot; = &quot;CHM_max_L1&quot;,</span></span>
<span id="cb18-33"><a href="crown-delineation.html#cb18-33" tabindex="-1"></a>  <span class="co">#        &quot;max_L2_poly&quot; = &quot;CHM_max_L2&quot;) %&gt;%</span></span>
<span id="cb18-34"><a href="crown-delineation.html#cb18-34" tabindex="-1"></a>  <span class="fu">left_join</span>(seg_extract, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;supercells&quot;</span>))</span>
<span id="cb18-35"><a href="crown-delineation.html#cb18-35" tabindex="-1"></a></span>
<span id="cb18-36"><a href="crown-delineation.html#cb18-36" tabindex="-1"></a><span class="fu">class</span>(seg1)</span>
<span id="cb18-37"><a href="crown-delineation.html#cb18-37" tabindex="-1"></a></span>
<span id="cb18-38"><a href="crown-delineation.html#cb18-38" tabindex="-1"></a><span class="fu">saveRDS</span>(seg1, <span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;Prop_Diameter&quot;</span>,percent,<span class="st">&quot;%OfZq99</span><span class="sc">\\</span><span class="st">SEG_intersection.rds&quot;</span>))</span>
<span id="cb18-39"><a href="crown-delineation.html#cb18-39" tabindex="-1"></a><span class="fu">colnames</span>(seg1)</span>
<span id="cb18-40"><a href="crown-delineation.html#cb18-40" tabindex="-1"></a></span>
<span id="cb18-41"><a href="crown-delineation.html#cb18-41" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> seg1, </span>
<span id="cb18-42"><a href="crown-delineation.html#cb18-42" tabindex="-1"></a>         <span class="at">dsn =</span> <span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;Prop_Diameter&quot;</span>,percent,<span class="st">&quot;%OfZq99</span><span class="sc">\\</span><span class="st">SEG_intersection.shp&quot;</span>),</span>
<span id="cb18-43"><a href="crown-delineation.html#cb18-43" tabindex="-1"></a>         <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>,</span>
<span id="cb18-44"><a href="crown-delineation.html#cb18-44" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-45"><a href="crown-delineation.html#cb18-45" tabindex="-1"></a></span>
<span id="cb18-46"><a href="crown-delineation.html#cb18-46" tabindex="-1"></a>seg2 <span class="ot">=</span> seg1 <span class="sc">%&gt;%</span> </span>
<span id="cb18-47"><a href="crown-delineation.html#cb18-47" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z50_L2 =</span> q99 <span class="sc">*</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="co">#filtering out supercells where the CHM value in that super cell as less than 50% of the 99th percentile (~50th height percentile)</span></span>
<span id="cb18-48"><a href="crown-delineation.html#cb18-48" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TAG_archive =</span> TAG,</span>
<span id="cb18-49"><a href="crown-delineation.html#cb18-49" tabindex="-1"></a>    <span class="at">TAG =</span> <span class="fu">if_else</span>(</span>
<span id="cb18-50"><a href="crown-delineation.html#cb18-50" tabindex="-1"></a>    max <span class="sc">&gt;</span> z50_L2, <span class="co">#&amp;</span></span>
<span id="cb18-51"><a href="crown-delineation.html#cb18-51" tabindex="-1"></a>    <span class="co"># max.CHM_max_L2 &gt; z50_L2,</span></span>
<span id="cb18-52"><a href="crown-delineation.html#cb18-52" tabindex="-1"></a>    TAG, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-53"><a href="crown-delineation.html#cb18-53" tabindex="-1"></a>  <span class="fu">group_by</span>(supercells) <span class="sc">%&gt;%</span> </span>
<span id="cb18-54"><a href="crown-delineation.html#cb18-54" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb18-55"><a href="crown-delineation.html#cb18-55" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TAG =</span> <span class="fu">if_else</span>(count <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="dv">0</span>, TAG))</span>
<span id="cb18-56"><a href="crown-delineation.html#cb18-56" tabindex="-1"></a></span>
<span id="cb18-57"><a href="crown-delineation.html#cb18-57" tabindex="-1"></a></span>
<span id="cb18-58"><a href="crown-delineation.html#cb18-58" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> seg2, </span>
<span id="cb18-59"><a href="crown-delineation.html#cb18-59" tabindex="-1"></a>         <span class="at">dsn =</span> <span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;Prop_Diameter&quot;</span>,percent,<span class="st">&quot;%OfZq99</span><span class="sc">\\</span><span class="st">SEGS_initial.shp&quot;</span>),</span>
<span id="cb18-60"><a href="crown-delineation.html#cb18-60" tabindex="-1"></a>         <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>,</span>
<span id="cb18-61"><a href="crown-delineation.html#cb18-61" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-62"><a href="crown-delineation.html#cb18-62" tabindex="-1"></a></span>
<span id="cb18-63"><a href="crown-delineation.html#cb18-63" tabindex="-1"></a><span class="fu">dim</span>(seg2)       </span>
<span id="cb18-64"><a href="crown-delineation.html#cb18-64" tabindex="-1"></a></span>
<span id="cb18-65"><a href="crown-delineation.html#cb18-65" tabindex="-1"></a>seg3 <span class="ot">=</span> seg2 <span class="sc">%&gt;%</span> </span>
<span id="cb18-66"><a href="crown-delineation.html#cb18-66" tabindex="-1"></a>  <span class="fu">filter</span>(TAG <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-67"><a href="crown-delineation.html#cb18-67" tabindex="-1"></a>  <span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-68"><a href="crown-delineation.html#cb18-68" tabindex="-1"></a>  <span class="fu">st_join</span>(<span class="at">y =</span> prop_hulls_forSEG, <span class="at">join =</span> st_within) <span class="sc">%&gt;%</span> </span>
<span id="cb18-69"><a href="crown-delineation.html#cb18-69" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-70"><a href="crown-delineation.html#cb18-70" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(supercells, geometry)</span>
<span id="cb18-71"><a href="crown-delineation.html#cb18-71" tabindex="-1"></a></span>
<span id="cb18-72"><a href="crown-delineation.html#cb18-72" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> seg3, </span>
<span id="cb18-73"><a href="crown-delineation.html#cb18-73" tabindex="-1"></a>         <span class="at">dsn =</span> <span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;Prop_Diameter&quot;</span>,percent,<span class="st">&quot;%OfZq99</span><span class="sc">\\</span><span class="st">SEGS_centroids.shp&quot;</span>),</span>
<span id="cb18-74"><a href="crown-delineation.html#cb18-74" tabindex="-1"></a>         <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>,</span>
<span id="cb18-75"><a href="crown-delineation.html#cb18-75" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-76"><a href="crown-delineation.html#cb18-76" tabindex="-1"></a></span>
<span id="cb18-77"><a href="crown-delineation.html#cb18-77" tabindex="-1"></a><span class="fu">plot</span>(seg3)</span>
<span id="cb18-78"><a href="crown-delineation.html#cb18-78" tabindex="-1"></a></span>
<span id="cb18-79"><a href="crown-delineation.html#cb18-79" tabindex="-1"></a>seg4 <span class="ot">=</span> seg2 <span class="sc">%&gt;%</span> </span>
<span id="cb18-80"><a href="crown-delineation.html#cb18-80" tabindex="-1"></a>  <span class="fu">st_join</span>(seg3) <span class="sc">%&gt;%</span> </span>
<span id="cb18-81"><a href="crown-delineation.html#cb18-81" tabindex="-1"></a>  <span class="fu">drop_na</span>() </span>
<span id="cb18-82"><a href="crown-delineation.html#cb18-82" tabindex="-1"></a></span>
<span id="cb18-83"><a href="crown-delineation.html#cb18-83" tabindex="-1"></a>seg5 <span class="ot">=</span> seg4 <span class="sc">%&gt;%</span> </span>
<span id="cb18-84"><a href="crown-delineation.html#cb18-84" tabindex="-1"></a>  <span class="fu">group_by</span>(TAG) <span class="sc">%&gt;%</span> </span>
<span id="cb18-85"><a href="crown-delineation.html#cb18-85" tabindex="-1"></a>  <span class="fu">summarise</span>()</span>
<span id="cb18-86"><a href="crown-delineation.html#cb18-86" tabindex="-1"></a></span>
<span id="cb18-87"><a href="crown-delineation.html#cb18-87" tabindex="-1"></a><span class="fu">plot</span>(seg5)</span>
<span id="cb18-88"><a href="crown-delineation.html#cb18-88" tabindex="-1"></a></span>
<span id="cb18-89"><a href="crown-delineation.html#cb18-89" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> seg4, </span>
<span id="cb18-90"><a href="crown-delineation.html#cb18-90" tabindex="-1"></a>         <span class="at">dsn =</span> <span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;Prop_Diameter&quot;</span>,percent,<span class="st">&quot;%OfZq99</span><span class="sc">\\</span><span class="st">SEGS_keep.shp&quot;</span>),</span>
<span id="cb18-91"><a href="crown-delineation.html#cb18-91" tabindex="-1"></a>         <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>,</span>
<span id="cb18-92"><a href="crown-delineation.html#cb18-92" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-93"><a href="crown-delineation.html#cb18-93" tabindex="-1"></a></span>
<span id="cb18-94"><a href="crown-delineation.html#cb18-94" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> seg5, </span>
<span id="cb18-95"><a href="crown-delineation.html#cb18-95" tabindex="-1"></a>         <span class="at">dsn =</span> <span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;Prop_Diameter&quot;</span>,percent,<span class="st">&quot;%OfZq99</span><span class="sc">\\</span><span class="st">SEGS_merge.shp&quot;</span>),</span>
<span id="cb18-96"><a href="crown-delineation.html#cb18-96" tabindex="-1"></a>         <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>,</span>
<span id="cb18-97"><a href="crown-delineation.html#cb18-97" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-98"><a href="crown-delineation.html#cb18-98" tabindex="-1"></a></span>
<span id="cb18-99"><a href="crown-delineation.html#cb18-99" tabindex="-1"></a>seg5_smooth <span class="ot">&lt;-</span> seg5 <span class="sc">%&gt;%</span> </span>
<span id="cb18-100"><a href="crown-delineation.html#cb18-100" tabindex="-1"></a>  <span class="fu">fill_holes</span>(<span class="at">threshold =</span> units<span class="sc">::</span><span class="fu">set_units</span>(<span class="dv">2000</span>, <span class="st">&quot;cm^2&quot;</span>))</span>
<span id="cb18-101"><a href="crown-delineation.html#cb18-101" tabindex="-1"></a></span>
<span id="cb18-102"><a href="crown-delineation.html#cb18-102" tabindex="-1"></a><span class="do">## CHECK:</span></span>
<span id="cb18-103"><a href="crown-delineation.html#cb18-103" tabindex="-1"></a><span class="co"># test_tree &lt;- seg5_smooth %&gt;%</span></span>
<span id="cb18-104"><a href="crown-delineation.html#cb18-104" tabindex="-1"></a><span class="co">#   filter(TAG_filtered == 664)</span></span>
<span id="cb18-105"><a href="crown-delineation.html#cb18-105" tabindex="-1"></a><span class="co"># plot(test_tree$geometry, col = &quot;red&quot;)</span></span>
<span id="cb18-106"><a href="crown-delineation.html#cb18-106" tabindex="-1"></a></span>
<span id="cb18-107"><a href="crown-delineation.html#cb18-107" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> seg5_smooth, </span>
<span id="cb18-108"><a href="crown-delineation.html#cb18-108" tabindex="-1"></a>         <span class="at">dsn =</span> <span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;Prop_Diameter&quot;</span>,percent,<span class="st">&quot;%OfZq99</span><span class="sc">\\</span><span class="st">SEGS_merge_smooth.shp&quot;</span>),</span>
<span id="cb18-109"><a href="crown-delineation.html#cb18-109" tabindex="-1"></a>         <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>,</span>
<span id="cb18-110"><a href="crown-delineation.html#cb18-110" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-111"><a href="crown-delineation.html#cb18-111" tabindex="-1"></a></span>
<span id="cb18-112"><a href="crown-delineation.html#cb18-112" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">st_geometry_type</span>(seg5_smooth))</span>
<span id="cb18-113"><a href="crown-delineation.html#cb18-113" tabindex="-1"></a></span>
<span id="cb18-114"><a href="crown-delineation.html#cb18-114" tabindex="-1"></a>seg5_smooth_NM <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(seg5_smooth, <span class="st">&quot;POLYGON&quot;</span>)</span>
<span id="cb18-115"><a href="crown-delineation.html#cb18-115" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb18-116"><a href="crown-delineation.html#cb18-116" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">st_geometry_type</span>(seg5_smooth_NM)) <span class="co"># should only have &quot;Polygon&quot; no more multipolygons</span></span>
<span id="cb18-117"><a href="crown-delineation.html#cb18-117" tabindex="-1"></a></span>
<span id="cb18-118"><a href="crown-delineation.html#cb18-118" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> seg5_smooth_NM, </span>
<span id="cb18-119"><a href="crown-delineation.html#cb18-119" tabindex="-1"></a>         <span class="at">dsn =</span> <span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;Prop_Diameter&quot;</span>,percent,<span class="st">&quot;%OfZq99</span><span class="sc">\\</span><span class="st">HULLS</span><span class="sc">\\</span><span class="st">SEGS_merge_smooth_NoMultipolygon.shp&quot;</span>),</span>
<span id="cb18-120"><a href="crown-delineation.html#cb18-120" tabindex="-1"></a>         <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>,</span>
<span id="cb18-121"><a href="crown-delineation.html#cb18-121" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-122"><a href="crown-delineation.html#cb18-122" tabindex="-1"></a></span>
<span id="cb18-123"><a href="crown-delineation.html#cb18-123" tabindex="-1"></a><span class="do">## adding in attributes back</span></span>
<span id="cb18-124"><a href="crown-delineation.html#cb18-124" tabindex="-1"></a>att <span class="ot">&lt;-</span> ttops <span class="sc">%&gt;%</span></span>
<span id="cb18-125"><a href="crown-delineation.html#cb18-125" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb18-126"><a href="crown-delineation.html#cb18-126" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(geometry))</span>
<span id="cb18-127"><a href="crown-delineation.html#cb18-127" tabindex="-1"></a></span>
<span id="cb18-128"><a href="crown-delineation.html#cb18-128" tabindex="-1"></a>(seg5_smooth_NM_attributes <span class="ot">&lt;-</span> <span class="fu">left_join</span>(seg5_smooth_NM,att, <span class="at">by =</span> <span class="st">&quot;TAG&quot;</span> ))</span>
<span id="cb18-129"><a href="crown-delineation.html#cb18-129" tabindex="-1"></a></span>
<span id="cb18-130"><a href="crown-delineation.html#cb18-130" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> seg5_smooth_NM_attributes, </span>
<span id="cb18-131"><a href="crown-delineation.html#cb18-131" tabindex="-1"></a>         <span class="at">dsn =</span> <span class="fu">paste0</span>(crown_dir_folder,<span class="st">&quot;Prop_Diameter&quot;</span>,percent,<span class="st">&quot;%OfZq99</span><span class="sc">\\</span><span class="st">HULLS</span><span class="sc">\\</span><span class="st">SEGS_merge_smooth_NoMultipolygon_Attributes.shp&quot;</span>),</span>
<span id="cb18-132"><a href="crown-delineation.html#cb18-132" tabindex="-1"></a>         <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>,</span>
<span id="cb18-133"><a href="crown-delineation.html#cb18-133" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="manually-edite-crowns" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Manually Edite Crowns<a href="crown-delineation.html#manually-edite-crowns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:delin-crowns"></span>
<img src="Photos_&_gifs/crowns.png" alt="Delineated crowns at Bit Tree Creek with partially obscured plot trees in purple." width="60%" />
<p class="caption">
Figure 8.1: Delineated crowns at Bit Tree Creek with partially obscured plot trees in purple.
</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="georeferencing-plot-trees.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="lidar-processing-workflow.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/owaite/GenomeBC_BPG/edit/main/0_Crown_delineation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/owaite/GenomeBC_BPG/blob/main/0_Crown_delineation.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
